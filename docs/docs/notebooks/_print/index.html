<!doctype html>
<html itemscope itemtype="http://schema.org/WebPage" lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.106.0">
<link rel="canonical" type="text/html" href="/palimpsest/docs/notebooks/">
<link rel="alternate" type="application/rss&#43;xml" href="/palimpsest/docs/notebooks/index.xml">
<meta name="robots" content="noindex, nofollow">


<link rel="shortcut icon" href="/palimpsest/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/palimpsest/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/palimpsest/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/palimpsest/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/palimpsest/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/palimpsest/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/palimpsest/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/palimpsest/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/palimpsest/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/palimpsest/favicons/android-192x192.png" sizes="192x192">

<title>Notebooks | Palimpsest</title>
<meta name="description" content="General notes on services, applications, and other tools.
">
<meta property="og:title" content="Notebooks" />
<meta property="og:description" content="General notes on services, applications, and other tools.
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/palimpsest/docs/notebooks/" /><meta property="og:site_name" content="Palimpsest" />

<meta itemprop="name" content="Notebooks">
<meta itemprop="description" content="General notes on services, applications, and other tools.
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Notebooks"/>
<meta name="twitter:description" content="General notes on services, applications, and other tools.
"/>




<link rel="preload" href="/palimpsest/scss/main.min.def2cdda5cfcd95d9660c969a68946395435ad5fc75402be473d9995c7e926b3.css" as="style">
<link href="/palimpsest/scss/main.min.def2cdda5cfcd95d9660c969a68946395435ad5fc75402be473d9995c7e926b3.css" rel="stylesheet" integrity="">

<script
  src="https://code.jquery.com/jquery-3.6.0.min.js"
  integrity="sha384-vtXRMe3mGCbOeY7l30aIg8H9p3GdeSe4IFlP6G8JMa7o7lXvnz3GFKzPxzJdPfGK"
  crossorigin="anonymous"></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-00000000-0"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'UA-00000000-0');
}
</script>
  </head>
  <body class="td-section">
    <header>
      <nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
  <a class="navbar-brand" href="/palimpsest/"><span class="navbar-brand__logo navbar-logo"></span><span class="navbar-brand__name">Palimpsest</span></a>
  <div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
    <ul class="navbar-nav mt-2 mt-lg-0">
      </ul>
  </div>
  <div class="navbar-nav d-none d-lg-block">
    
  </div>
</nav>
    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This is the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/palimpsest/docs/notebooks/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Notebooks</h1>
<div class="lead">General notes on services, applications, and other tools.</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-ee0193cf90111c6669c664c29fa709de"></a></li>


    
  
    
    
	
<li>2: <a href="#pg-f0113419da948951b7f436148936e95a">Business Apps</a></li>


    
  
    
    
	
<li>3: <a href="#pg-0fcb5640f2640346bd4a47315370c322">Cables</a></li>


    
  
    
    
	
<li>4: <a href="#pg-c6960039aab2d9b3b862578ff2929d1c">Certbot</a></li>


    
  
    
    
	
<li>5: <a href="#pg-4ad2b25d02d74a84c71fca264866a376">Chroot SFTP Setup</a></li>


    
  
    
    
	
<li>6: <a href="#pg-68612a30548049b0cf843428f3a4bb34">Cron</a></li>


    
  
    
    
	
<li>7: <a href="#pg-4fadb91a29d7a148513da6b09327af5a">Docker</a></li>


    
  
    
    
	
<li>8: <a href="#pg-c7bfa435c83022c5e4cc0444ecb23608">Expanding Volumes</a></li>


    
  
    
    
	
<li>9: <a href="#pg-0e799a6db188a1db337880ce0965a20a">EZproxy</a></li>


    
  
    
    
	
<li>10: <a href="#pg-77a56ba1626faf6846806ca300e5dfff">fail2ban</a></li>


    
  
    
    
	
<li>11: <a href="#pg-4342c99a6ae391fcf2ac9f3495a2121d">Git</a></li>


    
  
    
    
	
<li>12: <a href="#pg-b8c18d523022e4f3f97301e4a25f6183">GPG</a></li>


    
  
    
    
	
<li>13: <a href="#pg-edb5ffd6fb9449c40e4bfc1d024eb031">Graphing Tool</a></li>


    
  
    
    
	
<li>14: <a href="#pg-87b868e5e394859d9f1f14a150a3a878">Homebrew</a></li>


    
  
    
    
	
<li>15: <a href="#pg-1c8c3e9fefdae28d6744f4228674e642">JS Forms</a></li>


    
  
    
    
	
<li>16: <a href="#pg-9f24a04f29e3f43c63967cbfaf5d2127">LVM</a></li>


    
  
    
    
	
<li>17: <a href="#pg-66b757734131fa5bcd4bc6aebee1d53f">Mailman</a></li>


    
  
    
    
	
<li>18: <a href="#pg-360ce071c494917ed482e511bb393a68">Monit</a></li>


    
  
    
    
	
<li>19: <a href="#pg-1066e9965c05de85e8ca18c881b85e50">networker</a></li>


    
  
    
    
	
<li>20: <a href="#pg-0a7bef099b83bb4e8423d6b11e27685b">Networking</a></li>


    
  
    
    
	
<li>21: <a href="#pg-9f11946e110fe4b06c0064964424e26b">Packages</a></li>


    
  
    
    
	
<li>22: <a href="#pg-fcebe50774b0c7ff0550bb1893f7c7f8">Perlbrew</a></li>


    
  
    
    
	
<li>23: <a href="#pg-93a572212945aac4962b87f6a08892b2">Postfix</a></li>


    
  
    
    
	
<li>24: <a href="#pg-d46f9035d465ecc234a3d5d560fb7dcf">PostgreSQL</a></li>


    
  
    
    
	
<li>25: <a href="#pg-4d001ac0694ab5a6134c85705ed758b8">Python4Lib</a></li>


    
  
    
    
	
<li>26: <a href="#pg-deab9c3f5809ad887498368c25842ebc">React.js</a></li>


    
  
    
    
	
<li>27: <a href="#pg-8a51d7972e5f4f1e0f8eecb27948bd81">Samba</a></li>


    
  
    
    
	
<li>28: <a href="#pg-97ba8b7270d986b9bc05453c9816bf53">sed &amp; awk</a></li>


    
  
    
    
	
<li>29: <a href="#pg-a35b90e7084d279f74ffcbdc5fac0a1f">SIP2</a></li>


    
  
    
    
	
<li>30: <a href="#pg-4afcd525437783c4871fc01163c00b1d">SSH</a></li>


    
  
    
    
	
<li>31: <a href="#pg-fa3c0e256e14bb859b3cc5b5639d1bfb">SSL</a></li>


    
  
    
    
	
<li>32: <a href="#pg-e64f462522bc621294722a4446c22a9f">SysAdmin Tasks</a></li>


    
  
    
    
	
<li>33: <a href="#pg-330296a33da2967fa7e490b7318daf81">Yaz</a></li>


    
  

    </ul>


<div class="content">
      
</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="">
    
	<h1 id="pg-ee0193cf90111c6669c664c29fa709de">1 - </h1>
    
	<p><a href="https://github.com/topics/pdf-parsing">https://github.com/topics/pdf-parsing</a>
<a href="https://github.com/topics/table-extraction">https://github.com/topics/table-extraction</a></p>
<p><a href="https://github.com/topics/visidata">https://github.com/topics/visidata</a></p>
<p><a href="https://github.com/topics/sierra-api">https://github.com/topics/sierra-api</a>
<a href="https://github.com/topics/innovative-interfaces">https://github.com/topics/innovative-interfaces</a></p>
<p><a href="https://github.com/topics/metadata">https://github.com/topics/metadata</a></p>
<p><a href="https://github.com/topics/code4lib">https://github.com/topics/code4lib</a></p>
<p><a href="https://github.com/topics/bagit">https://github.com/topics/bagit</a>
<a href="https://github.com/topics/oai-pmh">https://github.com/topics/oai-pmh</a></p>
<p><a href="https://github.com/topics/marcxml-record">https://github.com/topics/marcxml-record</a>
<a href="https://github.com/topics/marc">https://github.com/topics/marc</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-f0113419da948951b7f436148936e95a">2 - Business Apps</h1>
    <div class="lead">A small collection of open source applications, with a focus on common applications required to operate a small business.</div>
	<h2 id="sales">Sales</h2>
<ul>
<li><a href="https://github.com/invoiceninja/ansible-installer">Invoice Ninja</a></li>
<li><a href="https://www.odoo.com/">Odoo</a></li>
</ul>
<h2 id="project-management">Project Management</h2>
<ul>
<li><a href="https://www.orangescrum.org/">Orangescrum</a></li>
<li><a href="https://taiga.io/">Taiga</a></li>
<li><a href="https://www.tuleap.org">Tuleap</a></li>
</ul>
<h2 id="security---social-engineering">Security - Social Engineering</h2>
<ul>
<li><a href="https://getgophish.com/">GoPhish</a></li>
</ul>
<h2 id="infrastructure-and-application-monitoring">Infrastructure and Application Monitoring</h2>
<ul>
<li><a href="https://prometheus.io/">Prometheus</a></li>
<li><a href="https://mmonit.com/monit/">Monit</a></li>
<li><a href="https://cockpit-project.org/">Cockpit</a></li>
<li><a href="https://nicolargo.github.io/glances/">Glances</a></li>
<li><a href="https://grafana.com/">Grafana</a></li>
<li><a href="https://www.graylog.org/products/open-source">graylog</a></li>
</ul>
<h2 id="password-management">Password Management</h2>
<ul>
<li><a href="https://bitwarden.com/">Bitwarden</a></li>
</ul>
<h2 id="website-frameworks-and-publishing-platforms">Website Frameworks and Publishing Platforms</h2>
<ul>
<li><a href="https://gohugo.io/">Hugo</a></li>
<li><a href="https://ghost.org/">ghost</a></li>
</ul>
<h2 id="identity-management--directory-services">Identity Management &amp; Directory Services</h2>
<ul>
<li><a href="https://www.keycloak.org/">Keycloak</a></li>
<li><a href="https://www.openldap.org/">OpenLDAP</a></li>
<li><a href="https://www.gluu.org/">Gluu</a></li>
</ul>
<h2 id="office-productivity">Office Productivity</h2>
<ul>
<li><a href="https://www.libreoffice.org/">LibreOffice</a></li>
</ul>
<h2 id="file-sync-and-share">File Sync and Share</h2>
<ul>
<li><a href="https://nextcloud.com/">Nextcloud</a></li>
<li><a href="https://pydio.com/en">Pydio</a></li>
<li><a href="https://owncloud.org/">OwnCloud</a></li>
</ul>
<h2 id="messaging-platforms">Messaging Platforms</h2>
<ul>
<li><a href="https://mattermost.com/">Mattermost</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0fcb5640f2640346bd4a47315370c322">3 - Cables</h1>
    <div class="lead">Documentation and tool for identifying cables and connectors.</div>
	<ul>
<li><a href="https://amiaopensource.github.io/cable-bible/">The Cable Bibles</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c6960039aab2d9b3b862578ff2929d1c">4 - Certbot</h1>
    <div class="lead">Common commands for operating Let&rsquo;s Encrypt certbot</div>
	<h2 id="certbot">Certbot</h2>
<p><a href="https://certbot.eff.org/">certbot</a> for <a href="https://letsencrypt.org/">Let&rsquo;s Encrypt</a> with code on <a href="https://github.com/certbot/certbot">GitHub</a></p>
<h2 id="common-commands">Common Commands</h2>
<p><a href="https://certbot.eff.org/docs/using.html">certbot user guide</a></p>
<ul>
<li><code>certbot renew</code> Attempt to renew all certificates</li>
<li><code>certbot certificates</code> List all certificates</li>
<li><code>certbot delete --cert-name domaintoremove.com</code> Delete a certificate</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4ad2b25d02d74a84c71fca264866a376">5 - Chroot SFTP Setup</h1>
    <div class="lead">Setting up Chroot SFTP for a user without SSH</div>
	<p><strong>Scenario</strong>: Callimachus works at Miskatonic University. Callimachus is working on a project that requires the placement of data files onto a remote server owned by Permissible Data Corp. (PDC). PDC will be processing the files with an automated script and returning them to Callimachus.</p>
<p>You&rsquo;ll need some users that will only be able to perform chrooted SFTP. You&rsquo;ll probably want to place them into a group for simplfied administration.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#create SFTP only group</span>
</span></span><span style="display:flex;"><span>groupadd sftponly
</span></span></code></pre></div><p>Since we&rsquo;ll be using this SFTP user group to allow some of our libraries to upload files for automated processing, we&rsquo;ll call the SFTP directory <code>/incoming</code>, to identify the functional role of the directory in the automated processing chain.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># create user miskatonic, assign to STFP group, and disable SSH access </span>
</span></span><span style="display:flex;"><span>useradd -g sftponly -d /incoming -s /sbin/nologin miskatonic 
</span></span></code></pre></div><p>Set up the password for user miskatonic</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>passwd miskatonic
</span></span></code></pre></div><p>Confirm that you&rsquo;ve set up this user properly</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grep miskatonic /etc/passwd
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># miskatonic:x:500:500::/incoming:/sbin/nologin</span>
</span></span></code></pre></div><h3 id="modify-ssh-configuration">Modify SSH Configuration</h3>
<p>Setting up the chroot jail environment will require the directory path be created to act as the SFTP user&rsquo;s home directory, a number of modifications to the SSH configuration, and some permissions adjustments.</p>
<p>Let&rsquo;s start with some SSH configuration changes. You&rsquo;ll also need to enable the internal-sftp server. To do so, you&rsquo;ll need to modify the configuration for SSH.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nano /etc/ssh/sshd_config
</span></span></code></pre></div><p>Comment out the default SFTP server and add the internal SFTP to the SSH daemon config file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#Subsystem	sftp	/usr/libexec/openssh/sftp-server</span>
</span></span><span style="display:flex;"><span>Subsystem	sftp	internal-sftp
</span></span></code></pre></div><p>You&rsquo;ll want to place any users that are assigned to group sftponly into the chrooted jail. You might also want to enable passwordless SFTP access with SSH keys. To make this happen, add a matchpoint to the SSH configuration file and then define the directives for the group.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Match Group sftponly
</span></span><span style="display:flex;"><span>		ChrootDirectory /sftp/%u <span style="color:#8f5902;font-style:italic">#%u indicates the user</span>
</span></span><span style="display:flex;"><span>		AuthorizedKeysFile /sftp/%u/.ssh/authorized_keys <span style="color:#8f5902;font-style:italic"># SFTP-only user&#39;s public key</span>
</span></span><span style="display:flex;"><span>		ForceCommand internal-sftp
</span></span></code></pre></div><p>You&rsquo;ll also want to ensure that key-based logins are enabled in the SSH configuration. Find the following lines in <code>/etc/ssh/sshd_config</code> and make sure they are present and uncomments.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Pubkey Authentication yes
</span></span><span style="display:flex;"><span>RSAAuthentication yes
</span></span></code></pre></div><h3 id="create-supporting-directory-structure">Create Supporting Directory Structure</h3>
<p>Create the substitute <code>/home</code> directory for your SFTP-only users.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir /sftp
</span></span></code></pre></div><p>Establish the SFTP-only user directory in the new path. This will become the root <code>/</code> for the SFTP-only users.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir /sftp/miskatonic
</span></span></code></pre></div><p>Since we want our SFTP-only users to see the <code>/incoming</code> directoy when they <code>cd</code>, we&rsquo;ll need to create it. This will be the location that they place any uploaded files to be processed by the automated script.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir /sftp/miskatonic/incoming
</span></span></code></pre></div><p>Set up the proper permission on the newly created directory for the SFTP-only user</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chown miskatonic:sftponly /sftp/miskatonic/incoming
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># root should continue to own /sftp/miskatonic and /sftp</span>
</span></span></code></pre></div><p>Set up the <code>/.ssh</code> to hold the public keys that will be granted access to an SFTP-only user&rsquo;s pseudo-home directory.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> /sftp/miskatonic/
</span></span><span style="display:flex;"><span>mkdir .ssh
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> /sftp/miskatonic/.ssh
</span></span><span style="display:flex;"><span>nano authorized_keys <span style="color:#8f5902;font-style:italic"># add the public keys to file and save</span>
</span></span></code></pre></div><p>Set proper permissions for key-based SSH logins</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>chown -R miskatonic:miskatonic /sftp/miskatonic/.ssh
</span></span><span style="display:flex;"><span>chmod <span style="color:#0000cf;font-weight:bold">700</span> /sftp/miskatonic/.ssh
</span></span><span style="display:flex;"><span>chmod <span style="color:#0000cf;font-weight:bold">600</span> /sftp/miskatonic/.ssh/authorized_keys
</span></span></code></pre></div><p>Restart SSH to pull in the changes</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>service sshd restart
</span></span></code></pre></div><h3 id="test-the-configuration">Test the configuration</h3>
<p>These are steps that need to be taken on the client. You&rsquo;ll need to generate a key-pair for the key-based SSH authentication. Most likely, you&rsquo;ll want to place the sftp-only key into your user&rsquo;s <code>/.ssh/</code> directory.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> /home/callimachus/.ssh
</span></span><span style="display:flex;"><span>ssh-keygen -t rsa -b <span style="color:#0000cf;font-weight:bold">4096</span> <span style="color:#8f5902;font-style:italic"># Increase bits to 4096 (brute force hardening)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># You can change the name of the keypair to identify its role or function. </span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Keep an eye for &#39;Your public key has been saved in /home/callimachus/.ssh/FILENAME.pub&#39;</span>
</span></span></code></pre></div><p>You&rsquo;ll need to copy FILENAME.pub to the remote server&rsquo;s /sftp/miskatonic/.ssh/authorized_keys file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"></code></pre></div><p>Test the connection to the SFTP-only directory from your client.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># if using key-based SSH login</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sftp -i /path/to/private-key.pem miskatonic@IPADDRESS 
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># If not using key-based SSH login:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sftp miskatonic@IPADDRESS
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># miskatonic@IPADDRESS password:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>sftp&gt; <span style="color:#204a87">pwd</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Remote working directory: /incoming</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-68612a30548049b0cf843428f3a4bb34">6 - Cron</h1>
    <div class="lead">Scheduling Tasks with Cron</div>
	<h2 id="scheduler-basics">Scheduler Basics</h2>
<p><code>minute:hour:day-of-month:month:day-of-week /command/to/execute.sh</code></p>
<table>
<thead>
<tr>
<th>Field</th>
<th>Values</th>
<th>Notes</th>
</tr>
</thead>
<tbody>
<tr>
<td>Minute</td>
<td>0-59</td>
<td></td>
</tr>
<tr>
<td>Hour</td>
<td>0-23</td>
<td></td>
</tr>
<tr>
<td>Day of Month</td>
<td>1-31</td>
<td></td>
</tr>
<tr>
<td>Month</td>
<td>1-12</td>
<td></td>
</tr>
<tr>
<td>Day Of Week</td>
<td>0-6</td>
<td>[0 is Sunday]</td>
</tr>
</tbody>
</table>
<h2 id="common-commands-w-cron">Common Commands w/ Cron</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>crontab -l  	<span style="color:#8f5902;font-style:italic"># List current Linux user&#39;s crontab entries</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crontab -u &lt;username&gt; -l <span style="color:#8f5902;font-style:italic"># List other Linux user&#39;s crontan entries</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crontab -e 		<span style="color:#8f5902;font-style:italic"># Edit crontab entries</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>crontab /path/to/cronjobs.txt <span style="color:#8f5902;font-style:italic"># Load cron jobs from file</span>
</span></span></code></pre></div><h2 id="examples-of-crontab-entries">Examples of Crontab Entries</h2>
<h5 id="execute-job-every-ten-minutes">Execute job every ten minutes</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>*/10 * * * * /path/to/command.sh
</span></span></code></pre></div><h5 id="run-job-every-hour-between-8am---5pm-monday---friday">Run job every hour, between 8am - 5pm, Monday - Friday</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">00</span> 08-17 * * 1-5 /path/to/command.sh
</span></span></code></pre></div><h4 id="run-job-twice-a-day-at-noon-and-6pm">Run job twice a day, at noon and 6pm</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">00</span> 12,18 * * * /path/to/command.sh
</span></span></code></pre></div><h5 id="run-job-at-430am-on-saturday-send-stderr-to-stdout-to-null-device">Run job at 4:30am on Saturday, send stderr to stdout to null device</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">30</span> <span style="color:#0000cf;font-weight:bold">5</span> * * <span style="color:#0000cf;font-weight:bold">6</span> /home/s3backup/backup_ftpdata.sh &gt; /dev/null 2&gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><h5 id="conditional-execute-job-only-on-1st-tuesday-of-the-month">Conditional: Execute job only on 1st Tuesday of the month</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">0</span> <span style="color:#0000cf;font-weight:bold">3</span> 1-7 * *  <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">[</span> <span style="color:#4e9a06">`</span>date +<span style="color:#4e9a06">\%</span>a<span style="color:#4e9a06">`</span> <span style="color:#ce5c00;font-weight:bold">=</span> Tue <span style="color:#ce5c00;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">then</span> /path/to/ami-genie.sh<span style="color:#000;font-weight:bold">;</span> <span style="color:#204a87;font-weight:bold">fi</span>
</span></span></code></pre></div><h5 id="at-1130-on-sunday-download-the-ezproxy-rejectip-blacklist-from-github-and-write-the-file-to-usrlocalezmanageincludesglobal_reject_iptxt-send-an-email-with-the-download-details">At 11:30 on Sunday, download the EZproxy RejectIP Blacklist from GitHub and write the file to <code>/usr/local/ezmanage/includes/global_reject_ip.txt</code>. Send an email with the download details.</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">30</span> <span style="color:#0000cf;font-weight:bold">11</span> * * <span style="color:#0000cf;font-weight:bold">0</span> root /usr/bin/wget --output-document global_reject_ip.txt https://raw.githubusercontent.com/prbutler/EZProxy_IP_Blacklist/master/EZProxy_IP_Blacklist_RejectIP.txt -O /usr/local/ezmanage/includes/global_reject_ip.txt 2&gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000;font-weight:bold">|</span> mail -s <span style="color:#4e9a06">&#34;EZproxy: Refresh RejectIP File&#34;</span> -a <span style="color:#4e9a06">&#34;From: someuser \&lt;someuser@epv1.example.org\&gt;&#34;</span> anotheruser@example.org
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4fadb91a29d7a148513da6b09327af5a">7 - Docker</h1>
    <div class="lead">Reference notes while operating Docker</div>
	

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    These notes are likely stale

</div>

<hr>
<h2 id="basic-info">Basic Info</h2>
<ul>
<li>don&rsquo;t run docker commands as root <code>sudo usermod -aG docker callimachus</code></li>
<li><a href="https://hub.docker.com/">Docker Hub</a></li>
<li><a href="https://docs.docker.com/compose/">Docker Compose</a></li>
</ul>
<h4 id="reference-docker-commands">Reference: Docker Commands</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker info
</span></span><span style="display:flex;"><span>docker inspect
</span></span><span style="display:flex;"><span>docker <span style="color:#204a87">exec</span> -it
</span></span><span style="display:flex;"><span>docker run -d
</span></span><span style="display:flex;"><span>docker ps -a
</span></span><span style="display:flex;"><span>docker stop <span style="color:#ce5c00;font-weight:bold">[</span>my_container<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>docker rm <span style="color:#ce5c00;font-weight:bold">[</span>my_container<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>docker rmi <span style="color:#ce5c00;font-weight:bold">[</span>docker_image<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>docker volume rm <span style="color:#ce5c00;font-weight:bold">[</span>my_volume<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>docker volume create <span style="color:#ce5c00;font-weight:bold">[</span>my_volume<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>docker volume ls
</span></span><span style="display:flex;"><span>docker volume inspect <span style="color:#ce5c00;font-weight:bold">[</span>my_volume<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>docker container ls -aq <span style="color:#8f5902;font-style:italic"># list all containers</span>
</span></span><span style="display:flex;"><span>docker network ls <span style="color:#8f5902;font-style:italic"># list them all</span>
</span></span><span style="display:flex;"><span>docker network prune -a <span style="color:#8f5902;font-style:italic"># get rid of them all</span>
</span></span></code></pre></div><h4 id="tags">Tags</h4>
<blockquote>
<p>nginx # default to latest<br>
nginx:latest # specifically use tag latest<br>
centos:centos6 # pull centos 6 base image</p>
</blockquote>
<h2 id="lifecycle-management">Lifecycle Management</h2>
<h4 id="run-in-detached-mode-daemon-mode-background">Run in detached mode (daemon mode), background</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d --name<span style="color:#ce5c00;font-weight:bold">=</span>nginx nginx:latest
</span></span></code></pre></div><h4 id="restart-container">Restart Container</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker restart nginx
</span></span></code></pre></div><h4 id="execute-a-command-in-a-container-without-affecting-the-running-process">Execute a command in a container without affecting the running process</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#  Interactive, attach with a shell.</span>
</span></span><span style="display:flex;"><span>docker <span style="color:#204a87">exec</span> -it nginx /bin/bash
</span></span></code></pre></div><h4 id="list-processes">List processes</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker ps <span style="color:#8f5902;font-style:italic"># Running Processes</span>
</span></span><span style="display:flex;"><span>docker ps -a <span style="color:#8f5902;font-style:italic"># Running and Stopped Processes</span>
</span></span></code></pre></div><h4 id="remove-images-when-no-containers-are-based-upon-it">remove images, when no containers are based upon it</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker rmi centos:centos6
</span></span></code></pre></div><p>docker image prune # remove all currently unused imaged
docker image prune -a # clear everything</p>
<h4 id="remove-containers">Remove containers</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker rm nginx:old
</span></span><span style="display:flex;"><span>docker system prune <span style="color:#8f5902;font-style:italic"># remove all stopped containers, images, unused networks</span>
</span></span></code></pre></div><h4 id="stop-all-containers-remove-all-stopped-containers-using-bash-command-substitution">Stop all containers. Remove all stopped containers, using bash command substitution</h4>
<p>docker container stop $(docker container ls -aq) # stop all containers
docker container rm $(docker container ls -aq) # remove all stopped containers
docker rmi -f $(docker images -aq)</p>
<h2 id="docker-inspect">Docker Inspect</h2>
<h4 id="get-info-about-container">get info about container</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker inspect
</span></span></code></pre></div><h4 id="get-ip-address-of-container">get ip address of container</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker inspect nginx:latest <span style="color:#000;font-weight:bold">|</span> grep IPAddr
</span></span></code></pre></div><h2 id="ports-and-volumes">Ports and Volumes</h2>
<h4 id="volumes">volumes</h4>
<p>docker volume ls
docker volume rm
<code>docker volume prune</code></p>
<h4 id="ports">ports</h4>
<p>In docker-compose
<code>expose</code> -&gt; reveal ports to the docker environment
<code>ports</code> -&gt; expose ports to docker and to the host system (i.e. publish the ports)</p>
<h4 id="bind-ports">Bind ports</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># docker run -d -p HOSTPORT:CONTAINERPORT</span>
</span></span><span style="display:flex;"><span>docker run -d -p 8080:80 --name<span style="color:#ce5c00;font-weight:bold">=</span>WebServer nginx:latest
</span></span></code></pre></div><h4 id="create-a-mount-point-in-a-container">Create a mount point in a container</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># docker run -d -p 8080:80 --name=webserver -v HOSTVOLPATH:CONTAINERVOLPATH nginx:latest</span>
</span></span><span style="display:flex;"><span>docker run -d -p 8080:80 --name<span style="color:#ce5c00;font-weight:bold">=</span>webserver -v /home/user/www:/usr/share/nginx/html nginx:latest
</span></span></code></pre></div><h2 id="building-using-a-dockerfile">BUILDING, using a Dockerfile</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Execute in directory with dockerfile, or define path</span>
</span></span><span style="display:flex;"><span>docker build -t dzoladz/ubuntu .
</span></span></code></pre></div><h4 id="dockerfile">Dockerfile</h4>
<ul>
<li>each step in the build process is a new container</li>
<li>try to combine mulitple RUN commands when possible</li>
</ul>
<blockquote>
<p>RUN * applies to the base images<br>
CMD * applies to the container instantiated on the base image<br>
EXPOSE * expose container ports to host system</p>
</blockquote>
<h4 id="build-a-container-using-a-dockerfile-and-tag-it">Build a container using a Dockerfile and tag it</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker build -t keycloak-proxy .
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>docker run -d -p 80:80 -p 443:443 --name<span style="color:#ce5c00;font-weight:bold">=</span>keycloak-proxy keycloak-proxy:latest
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Reload Nginx config in running container</span>
</span></span><span style="display:flex;"><span>docker <span style="color:#204a87">exec</span> &lt;container name&gt; nginx -s reload
</span></span></code></pre></div><h2 id="applications">Applications</h2>
<h4 id="metabase">Metabase</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># NOTE: this will run Metabase without any persistent storage for the application.</span>
</span></span><span style="display:flex;"><span>docker run -d -p 3000:3000 --name metabase metabase/metabase
</span></span></code></pre></div><h4 id="owncloud">ownCloud</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d -p 8080:80 --name owncloud --mount <span style="color:#000">source</span><span style="color:#ce5c00;font-weight:bold">=</span>/Users/Derek/docker/owncloud,target<span style="color:#ce5c00;font-weight:bold">=</span>/var/www/html owncloud:8.1
</span></span></code></pre></div><h1 id="keyclock-docker-for-testing">Keyclock, Docker for Testing</h1>
<p>Notes on the installation of Keycloak using official <a href="https://hub.docker.com/r/jboss/keycloak/">jboss/keycloak</a> Docker image.</p>
<h2 id="install-git-and-docker">Install Git and Docker</h2>
<p>Add the GPG key for the official Docker repo</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -fsSL https://download.docker.com/linux/ubuntu/gpg <span style="color:#000;font-weight:bold">|</span> sudo apt-key add -
</span></span></code></pre></div><p>Add the Docker repository to APT sources</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>add-apt-repository <span style="color:#4e9a06">&#34;deb [arch=amd64] https://download.docker.com/linux/ubuntu </span><span style="color:#204a87;font-weight:bold">$(</span>lsb_release -cs<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06"> stable&#34;</span>
</span></span></code></pre></div><p>Update package database</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>apt-get update
</span></span></code></pre></div><p>Install from the Docker repo, not the Ubuntu 16.04 distribution package.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>apt-cache policy docker-ce
</span></span></code></pre></div><p>Install Docker Community Edition and Git</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>apt-get install -y docker-ce git
</span></span></code></pre></div><h2 id="add-keycloak-user">Add Keycloak User</h2>
<blockquote>
<p>Run docker as a non-root user</p>
</blockquote>
<p>Create the Keycloak user</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>adduser keycloak
</span></span></code></pre></div><p>Add keycloak user to the docker group. No sudo for docker commands</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>usermod -aG docker keycloak
</span></span></code></pre></div><h2 id="launch-keycloak-w-postgres">Launch Keycloak w/ Postgres</h2>
<p>Create the Keycloak network</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker network create keycloak-network
</span></span></code></pre></div><p>Deploy a PostGRES container for the Keycloak app</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d --name keycloak-db --net keycloak-network -e <span style="color:#000">POSTGRES_DB</span><span style="color:#ce5c00;font-weight:bold">=</span>keycloak -e <span style="color:#000">POSTGRES_USER</span><span style="color:#ce5c00;font-weight:bold">=</span>keycloak -e <span style="color:#000">POSTGRES_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>password postgres
</span></span></code></pre></div><p>Deploy the Keycloak container</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d --name keycloak-app --net keycloak-network -p 8443:8443 -e <span style="color:#000">DB_ADDR</span><span style="color:#ce5c00;font-weight:bold">=</span>keycloak-db -e <span style="color:#000">KEYCLOAK_USER</span><span style="color:#ce5c00;font-weight:bold">=</span>admin -e <span style="color:#000">KEYCLOAK_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>password jboss/keycloak
</span></span></code></pre></div><p>Start Keycloak with Proxy Forwarding for use with Nginx</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>docker run -d --name keycloak-app --net keycloak-network -p 8443:8443 -e <span style="color:#000">DB_ADDR</span><span style="color:#ce5c00;font-weight:bold">=</span>keycloak-db -e <span style="color:#000">KEYCLOAK_USER</span><span style="color:#ce5c00;font-weight:bold">=</span>admin -e <span style="color:#000">KEYCLOAK_PASSWORD</span><span style="color:#ce5c00;font-weight:bold">=</span>password -e <span style="color:#000">PROXY_ADDRESS_FORWARDING</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">true</span> jboss/keycloak
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-c7bfa435c83022c5e4cc0444ecb23608">8 - Expanding Volumes</h1>
    <div class="lead">Provision additional storage on Ubuntu</div>
	<p>At some point, you&rsquo;re going to run out of space and need to provision some additional storage.</p>
<p>Steps:</p>
<ul>
<li>Expand Volume Capacity</li>
<li>Expand Partition to Volume Capacity</li>
<li>Extend Filesystem to the size of partition</li>
</ul>
<p>You&rsquo;ll need to know a few things like:</p>
<h5 id="what-block-devices-are-available">What block devices are available?</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>lsblk
</span></span></code></pre></div><h5 id="what-filesystem-am-i-using-on-a-partition">What filesystem am I using on a partition?</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>file -s /dev/sda1
</span></span><span style="display:flex;"><span>lsblk -f
</span></span><span style="display:flex;"><span>blkid
</span></span></code></pre></div><h5 id="what-is-the-current-capacity-of-storage-in-the-filesystem">What is the current capacity of storage in the filesystem?</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>df -h
</span></span></code></pre></div><h5 id="grow-the-first-partition-to-the-size-of-the-volume">Grow the first partition to the size of the volume</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>growpart /dev/sda <span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div><h5 id="resize-the-filesystem-to-the-size-of-the-partition">Resize the filesystem to the size of the partition</h5>
<p><em>command specific to filesystem used, this for ext</em></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>resize2fs /dev/sda1
</span></span></code></pre></div><h5 id="list-disk-usage--s-summarize-of-a-user">List disk usage -s summarize of a user</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>du -hs /home/marcload
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0e799a6db188a1db337880ce0965a20a">9 - EZproxy</h1>
    <div class="lead">Useful snippets for administering EZproxy</div>
	<p>A snippet of fragments useful for administering EZproxy</p>
<h2 id="reject-connections-that-originate-from-ips-outside-of-ohio-region">Reject connections that originate from IPs outside of Ohio region.</h2>
<p>Region codes should be specified using the two-character <a href="https://geolite.maxmind.com/download/geoip/misc/region_codes.csv">ISO 3166-2 subcountry code for the US</a>.</p>
<p>GeoLite data must also be configured on EZproxy (see the <a href="https://help.oclc.org/Library_Management/EZproxy/Configure_resources/Location">Location</a> section of the EZproxy manual).</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>::Common
</span></span><span style="display:flex;"><span>Set <span style="color:#000">access</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;deny&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>If Region<span style="color:#ce5c00;font-weight:bold">()</span> eq <span style="color:#4e9a06">&#34;OH&#34;</span><span style="color:#000;font-weight:bold">;</span> Set <span style="color:#000">access</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;allow&#34;</span>
</span></span><span style="display:flex;"><span>If access eq <span style="color:#4e9a06">&#34;deny&#34;</span><span style="color:#000;font-weight:bold">;</span> Deny irefused.htm
</span></span><span style="display:flex;"><span>/Common
</span></span></code></pre></div><p>Regex for use in the main authentication block. Deny all access, unless the location contains OH, IA, OR MI in the string.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Set <span style="color:#000">access</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;deny&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>If Region<span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">=</span>~ <span style="color:#4e9a06">&#34;/.*(OH|IA|MI).*/&#34;</span><span style="color:#000;font-weight:bold">;</span> Set <span style="color:#000">access</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;allow&#34;</span>
</span></span><span style="display:flex;"><span>If access eq <span style="color:#4e9a06">&#34;deny&#34;</span><span style="color:#000;font-weight:bold">;</span> Deny irefused.htm
</span></span></code></pre></div><p>The above should be placed before any <code>IfRefused; Deny irefused.htm</code> or <code>IfExpired; Deny iexpired.htm</code> directives in the main authentication block.</p>
<p>It&rsquo;s also possible to restrict authentication to US-based IPs, using the <code>IfCountry</code> function. <code>IfCountry</code> used the two-letter <a href="https://dev.maxmind.com/geoip/legacy/codes/iso3166/">ISO 3166 Country Codes</a>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Set <span style="color:#000">access</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;deny&#34;</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>IfCountry US<span style="color:#000;font-weight:bold">;</span> Set <span style="color:#000">access</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;allow&#34;</span>
</span></span><span style="display:flex;"><span>If access eq <span style="color:#4e9a06">&#34;deny&#34;</span><span style="color:#000;font-weight:bold">;</span> Deny irefused.htm
</span></span></code></pre></div><p><strong>NOTE</strong>: The above snippet of code needs to be placed <strong>within</strong> the authentication block to be actively restriction authentication attempts that originate from a non-US country code.</p>
<h2 id="supply-resource-credentials-within-an-iframe">Supply Resource Credentials within an iFrame</h2>
<p>There are times when you might need to Find/Replace username and password values within an <code>&lt;iframe&gt;</code> element The example below is a working draft of two auto-triggered functions to input credentials into the proper form fields.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Find &lt;/iframe&gt;
</span></span><span style="display:flex;"><span>Replace &lt;/iframe&gt;&lt;script&gt;<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">function</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span> setTimeout<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">function</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>window.frames<span style="color:#ce5c00;font-weight:bold">[</span>0<span style="color:#ce5c00;font-weight:bold">]</span>.document.getElementById<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;username&#39;</span><span style="color:#ce5c00;font-weight:bold">)</span>.value <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;USERNAME&#34;</span><span style="color:#000;font-weight:bold">;</span><span style="color:#ce5c00;font-weight:bold">}</span>, 1000<span style="color:#ce5c00;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">})()</span><span style="color:#000;font-weight:bold">;</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">function</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span> setTimeout<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">function</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>window.frames<span style="color:#ce5c00;font-weight:bold">[</span>0<span style="color:#ce5c00;font-weight:bold">]</span>.document.getElementById<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;password&#39;</span><span style="color:#ce5c00;font-weight:bold">)</span>.value <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;PASSWORD&#34;</span><span style="color:#000;font-weight:bold">;</span><span style="color:#ce5c00;font-weight:bold">}</span>, 1000<span style="color:#ce5c00;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#ce5c00;font-weight:bold">})()</span><span style="color:#000;font-weight:bold">;</span>&lt;/script&gt;
</span></span></code></pre></div><h2 id="regex-validation-of-saml-attributes-in-the-auth-namespace">Regex Validation of SAML Attributes in the Auth: Namespace</h2>
<p>SAML authorization check, within <code>shibuser.txt</code>, against the <code>userid</code> attribute released to EZproxy</p>
<blockquote>
<p>Authorize <code>userid</code>, if it begins with  1, 3, or 5. Otherwise, record <code>userid</code> and deny with <code>itype.htm</code></p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>If !<span style="color:#ce5c00;font-weight:bold">(</span>auth:userid <span style="color:#ce5c00;font-weight:bold">=</span>~ <span style="color:#4e9a06">&#34;/^(1|3|5).+</span>$<span style="color:#4e9a06">/&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span> Audit -expr auth:userid<span style="color:#000;font-weight:bold">;</span> Deny itype.htm<span style="color:#000;font-weight:bold">;</span> Stop
</span></span></code></pre></div><h2 id="grab-username-when-ezproxy-login-with-email-address">Grab Username, When EZproxy Login with Email Address</h2>
<p>This function uses an onclick event hook, i.e. <code>&lt;input onclick=&quot;processUsername()&quot; type=&quot;submit&quot; value=&quot;Sign in&quot;&gt;</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87;font-weight:bold">function</span> processUsername<span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>  var <span style="color:#000">email</span> <span style="color:#ce5c00;font-weight:bold">=</span> document.getElementsByName<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;user&#39;</span><span style="color:#ce5c00;font-weight:bold">)[</span>0<span style="color:#ce5c00;font-weight:bold">]</span>.value<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>  var <span style="color:#000">username</span> <span style="color:#ce5c00;font-weight:bold">=</span> email.split<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;@&#39;</span><span style="color:#ce5c00;font-weight:bold">)[</span>0<span style="color:#ce5c00;font-weight:bold">]</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>	document.getElementsByName<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;user&#39;</span><span style="color:#ce5c00;font-weight:bold">)[</span>0<span style="color:#ce5c00;font-weight:bold">]</span>.value <span style="color:#ce5c00;font-weight:bold">=</span> username<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>	console.log<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;the username value submitted is: &#39;</span> + document.getElementsByName<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;user&#39;</span><span style="color:#ce5c00;font-weight:bold">)[</span>0<span style="color:#ce5c00;font-weight:bold">]</span>.value<span style="color:#ce5c00;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">}</span>
</span></span></code></pre></div><h2 id="auto-trigger-attribute-replacement-via-ezproxy-findreplace">Auto-trigger attribute replacement via EZproxy Find/Replace</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">function</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>
</span></span><span style="display:flex;"><span>        var <span style="color:#000">url</span> <span style="color:#ce5c00;font-weight:bold">=</span> document.getElementById<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;ctl00_BodyContent_ucShare_txtTitleURL&#39;</span><span style="color:#ce5c00;font-weight:bold">)</span>.value<span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        var <span style="color:#000">fixed_url</span> <span style="color:#ce5c00;font-weight:bold">=</span> url.replace<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;fod.infobase.com&#39;</span>, <span style="color:#4e9a06">&#39;fod-infobase-com&#39;</span><span style="color:#ce5c00;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span>        document.getElementById<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;ctl00_BodyContent_ucShare_txtTitleURL&#39;</span><span style="color:#ce5c00;font-weight:bold">)</span>.setAttribute<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;value&#39;</span>, fixed_url<span style="color:#ce5c00;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">})()</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><h2 id="ohiolink-ejc---proxy-rave-urls-through-ezproxy">OhioLINK EJC - Proxy Rave URLs through EZproxy</h2>
<p>This is an example Find/Replace directive which adds jQuery to the OhioLINK Electronic Journal Center&rsquo;s UI to rewrite article permalinks by prepending a proxy prefix to any RAVE URLs on the item details interface.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>Find &lt;/body&gt;
</span></span><span style="display:flex;"><span>Replace &lt;script <span style="color:#000">type</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;text/javascript&#34;</span>&gt;<span style="color:#204a87;font-weight:bold">$(</span>document<span style="color:#204a87;font-weight:bold">)</span>.ready<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">function</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">if</span> <span style="color:#ce5c00;font-weight:bold">(</span>window.location.href.indexOf<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;bw.opal-libraries.org&#34;</span><span style="color:#ce5c00;font-weight:bold">)</span> &gt; -1<span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">{</span><span style="color:#204a87;font-weight:bold">$(</span><span style="color:#4e9a06">&#39;a[href*=&#34;rave.ohiolink.edu&#34;]&#39;</span><span style="color:#204a87;font-weight:bold">)</span>.each<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">function</span><span style="color:#ce5c00;font-weight:bold">()</span> <span style="color:#ce5c00;font-weight:bold">{</span>var <span style="color:#000">href</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>this<span style="color:#204a87;font-weight:bold">)</span>.prop<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;href&#39;</span><span style="color:#ce5c00;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>var <span style="color:#000">prefix</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;https://login.bw.opal-libraries.org/login?url=&#39;</span><span style="color:#000;font-weight:bold">;</span>var <span style="color:#000">result</span><span style="color:#ce5c00;font-weight:bold">=</span>prefix+href<span style="color:#000;font-weight:bold">;</span><span style="color:#204a87;font-weight:bold">$(</span>this<span style="color:#204a87;font-weight:bold">)</span>.attr<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#34;href&#34;</span>, result<span style="color:#ce5c00;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#204a87;font-weight:bold">$(</span>this<span style="color:#204a87;font-weight:bold">)</span>.text<span style="color:#ce5c00;font-weight:bold">(</span>result<span style="color:#ce5c00;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span>console.log<span style="color:#ce5c00;font-weight:bold">(</span>result<span style="color:#ce5c00;font-weight:bold">)</span><span style="color:#000;font-weight:bold">;</span><span style="color:#ce5c00;font-weight:bold">})</span><span style="color:#000;font-weight:bold">;</span><span style="color:#ce5c00;font-weight:bold">}})</span><span style="color:#000;font-weight:bold">;</span>&lt;/script&gt;&lt;/body&gt;
</span></span></code></pre></div><h2 id="cron-jobs-for-monitoring-activity">Cron Jobs for Monitoring Activity</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">10</span> <span style="color:#0000cf;font-weight:bold">0</span> * * * find /usr/local -name messages.txt <span style="color:#000;font-weight:bold">|</span> xargs grep -E <span style="color:#4e9a06">&#34;Unrecognized|DANGER|hosts\s36[0-9][0-9]&#34;</span> <span style="color:#000;font-weight:bold">|</span> mail -E -s <span style="color:#4e9a06">&#34;EZproxy Warning Messages&#34;</span> -a <span style="color:#4e9a06">&#34;From: root \&lt;root@{hostname}\&gt;&#34;</span> recipient@derekzoladz.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">20</span> <span style="color:#0000cf;font-weight:bold">0</span> * * * find /usr/local/ezproxy/audit/<span style="color:#204a87;font-weight:bold">$(</span>date --date<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;yesterday&#39;</span> <span style="color:#4e9a06">&#34;+\%Y\%m\%d&#34;</span><span style="color:#204a87;font-weight:bold">)</span>.txt -type f <span style="color:#000;font-weight:bold">|</span> xargs grep -E <span style="color:#4e9a06">&#34;exceeded&#34;</span> <span style="color:#000;font-weight:bold">|</span> mail -E -s <span style="color:#4e9a06">&#34;EZproxy Exceeding Usage Limit&#34;</span> -a <span style="color:#4e9a06">&#34;From: root \&lt;root@{hostname}\&gt;&#34;</span> recipient@derekzoladz.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">30</span> <span style="color:#0000cf;font-weight:bold">0</span> * * * find /usr/local/ezproxy/audit/<span style="color:#204a87;font-weight:bold">$(</span>date --date<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;yesterday&#39;</span> <span style="color:#4e9a06">&#34;+\%Y\%m\%d&#34;</span><span style="color:#204a87;font-weight:bold">)</span>.txt -type f -print<span style="color:#000;font-weight:bold">|</span> xargs grep -E <span style="color:#4e9a06">&#34;Login.Intruder.IP&#34;</span> <span style="color:#000;font-weight:bold">|</span> mail -E -s <span style="color:#4e9a06">&#34;EZproxy Login.Intruder.IP&#34;</span> -a <span style="color:#4e9a06">&#34;From: root \&lt;root@{hostname}\&gt;&#34;</span> recipient@derekzoladz.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">40</span> <span style="color:#0000cf;font-weight:bold">0</span> * * * find /usr/local/ezproxy/audit/<span style="color:#204a87;font-weight:bold">$(</span>date --date<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#39;yesterday&#39;</span> <span style="color:#4e9a06">&#34;+\%Y\%m\%d&#34;</span><span style="color:#204a87;font-weight:bold">)</span>.txt -type f -print <span style="color:#000;font-weight:bold">|</span> xargs grep -E <span style="color:#4e9a06">&#34;Session.ReconnectBlocked&#34;</span> <span style="color:#000;font-weight:bold">|</span> mail -E -s <span style="color:#4e9a06">&#34;EZproxy Session.ReconnectBlocked&#34;</span> -a <span style="color:#4e9a06">&#34;From: root \&lt;root@{hostname}\&gt;&#34;</span> recipient@derekzoladz.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">00</span> <span style="color:#0000cf;font-weight:bold">8</span> * * 1-5 find /usr/local/ezproxy/cookies -cmin +720 -type f <span style="color:#000;font-weight:bold">|</span> mail -E -s <span style="color:#4e9a06">&#34;EZproxy Sessions Over 12 Hours&#34;</span> -a <span style="color:#4e9a06">&#34;From: root \&lt;root@{hostname}\&gt;&#34;</span> recipient@derekzoladz.com
</span></span></code></pre></div><h2 id="doi-system---strip-parameters-from-dois">DOI System - Strip Parameters from DOIs</h2>
<p>Although valid extensions of the Document Object Model, passing parameters in the doi can cause resolution issues within EZproxy sessions.</p>
<blockquote>
<p>{host}?locatt=label:secondary_bloomsburyCollections</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>SPUEditVar <span style="color:#000">proxy_login</span><span style="color:#ce5c00;font-weight:bold">=</span>login?url<span style="color:#ce5c00;font-weight:bold">=</span>
</span></span><span style="display:flex;"><span>SPUEdit @^<span style="color:#ce5c00;font-weight:bold">(</span>https:<span style="color:#4e9a06">\/\/</span>doi.org<span style="color:#4e9a06">\/</span><span style="color:#ce5c00;font-weight:bold">)(</span>10.<span style="color:#ce5c00;font-weight:bold">[</span>0-9<span style="color:#ce5c00;font-weight:bold">]</span>*<span style="color:#4e9a06">\/</span><span style="color:#ce5c00;font-weight:bold">)([</span>0-9<span style="color:#ce5c00;font-weight:bold">]</span>*<span style="color:#ce5c00;font-weight:bold">)(</span><span style="color:#4e9a06">\?</span><span style="color:#000">locatt</span><span style="color:#ce5c00;font-weight:bold">=</span>label.*<span style="color:#ce5c00;font-weight:bold">)</span><span style="color:#000">$@</span><span style="color:#4e9a06">${</span><span style="color:#000">proxy_login</span><span style="color:#4e9a06">}</span><span style="color:#000">$1$2$3</span>@ir
</span></span></code></pre></div><h2 id="doi-system---force-legacy-mode">DOI System - Force Legacy Mode</h2>
<p>Force DOI system resolution to the platform of the primary depositor using <code>mode:legacy</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>SPUEditVar <span style="color:#000">proxy_login</span><span style="color:#ce5c00;font-weight:bold">=</span>login?url<span style="color:#ce5c00;font-weight:bold">=</span>
</span></span><span style="display:flex;"><span>SPUEditVar <span style="color:#000">legacy_mode</span><span style="color:#ce5c00;font-weight:bold">=</span>?locatt<span style="color:#ce5c00;font-weight:bold">=</span>mode:legacy
</span></span><span style="display:flex;"><span>SPUEdit @^<span style="color:#ce5c00;font-weight:bold">(</span>https:<span style="color:#4e9a06">\/\/</span>doi.org<span style="color:#4e9a06">\/</span><span style="color:#ce5c00;font-weight:bold">)(</span>10.<span style="color:#ce5c00;font-weight:bold">[</span>0-9<span style="color:#ce5c00;font-weight:bold">]</span>*<span style="color:#4e9a06">\/</span><span style="color:#ce5c00;font-weight:bold">)([</span>0-9<span style="color:#ce5c00;font-weight:bold">]</span>*<span style="color:#ce5c00;font-weight:bold">)(</span><span style="color:#4e9a06">\?</span><span style="color:#000">locatt</span><span style="color:#ce5c00;font-weight:bold">=</span>label.*<span style="color:#ce5c00;font-weight:bold">)</span><span style="color:#000">$@</span><span style="color:#4e9a06">${</span><span style="color:#000">proxy_login</span><span style="color:#4e9a06">}</span><span style="color:#000">$1$2$3</span><span style="color:#4e9a06">${</span><span style="color:#000">legacy_mode</span><span style="color:#4e9a06">}</span>@ir
</span></span></code></pre></div><h2 id="group-based-access-to-loggedin-files">Group-based Access to /Loggedin Files</h2>
<ol>
<li>In <code>user.txt</code>, create the authenticated group</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>::group<span style="color:#ce5c00;font-weight:bold">=</span>SecretFiles+Admin.Groups
</span></span><span style="display:flex;"><span>user:password
</span></span></code></pre></div><ol start="2">
<li>Establish a <code>../loggedin/</code> directory for the named Group from <code>user.txt</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>./docs/loggedin/SecretFiles
</span></span></code></pre></div><h2 id="issue-a-manual-call-to-the-sierra-patron-api">Issue a Manual Call to the Sierra Patron API</h2>
<p>Given a Sierra Patron Record containing <code>P BARCODE[pb]=fakeuser1234</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl --interface eth0:48 https://<span style="color:#ce5c00;font-weight:bold">{</span>sierra-server-domain<span style="color:#ce5c00;font-weight:bold">}</span>:54620/PATRONAPI/fakeuser1234/dump
</span></span></code></pre></div><p>If successful, the call will return patron data; otherwise, a failure message will be returned with additional information to diagnose the issue. For example:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>&lt;BODY&gt;ERRNUM<span style="color:#ce5c00;font-weight:bold">=</span>2&lt;BR&gt;
</span></span><span style="display:flex;"><span><span style="color:#000">ERRMSG</span><span style="color:#ce5c00;font-weight:bold">=</span>Record ID not unique&lt;BR&gt;
</span></span><span style="display:flex;"><span>&lt;/BODY&gt;
</span></span></code></pre></div><h2 id="temp-access-iii-server-migrations">Temp Access, III Server Migrations</h2>
<p>Migrating from local to III-hosted Sierra involves 6-8 hours of server downtime. If EZproxy relies on the Sierra Patron API for authentication, remote database access will be unavailable during the server migration. The following snippet will present <code>/login.htm</code> to the user, but will accept credentials and grant access to <em>all</em>. Use with extreme caution.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>::III
</span></span><span style="display:flex;"><span>Host https://sierra.catalog.org:54620
</span></span><span style="display:flex;"><span>IfRefused<span style="color:#000;font-weight:bold">;</span> Ignore
</span></span><span style="display:flex;"><span>IfInvalid<span style="color:#000;font-weight:bold">;</span> Ignore
</span></span><span style="display:flex;"><span>IfUnauthenticated<span style="color:#000;font-weight:bold">;</span> Stop
</span></span><span style="display:flex;"><span>/III
</span></span></code></pre></div><h2 id="transparent-language--saml-based-sso">Transparent Language &amp; SAML-based SSO</h2>
<p>When accessing Ohio&rsquo;s statewide subscription to Transparent Language Online though an EZProxy instance that connects tp a SAML-based authentication server, the platform will not recognize the IP to allow people to sign up. This solution basically forces everyone to log into EZproxy, but with a RedirectSafe entry so that Transparent Language can look for your EZproxy Referer.</p>
<p>In <code>config.txt</code>, you&rsquo;ll add the following stanza above any <code>ExcludeIP</code> directives.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span># -------------------------------------------------------
</span></span><span style="display:flex;"><span># **All users must authenticate through ezproxy**
</span></span><span style="display:flex;"><span>#
</span></span><span style="display:flex;"><span>T Transparent Language Redirect
</span></span><span style="display:flex;"><span>U -Refresh transparent-language https://library.transparent.com/ohio
</span></span><span style="display:flex;"><span>#
</span></span><span style="display:flex;"><span>T Transparent Language
</span></span><span style="display:flex;"><span>U https://library.transparent.com/ohio
</span></span><span style="display:flex;"><span>HJ library.transparent.com
</span></span><span style="display:flex;"><span>DJ transparent.com
</span></span><span style="display:flex;"><span>NeverProxy transparent.com
</span></span><span style="display:flex;"><span>NeverProxy library.transparent.com
</span></span><span style="display:flex;"><span># -------------------------------------------------------
</span></span></code></pre></div><p>The contents of the HTML file placed in the <code>docs/limited/transparent_langauges.htm</code> file are as follows:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">head</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">meta</span> <span style="color:#c4a000">name</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;referrer&#34;</span> <span style="color:#c4a000">content</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;always&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">noscript</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">META</span> <span style="color:#c4a000">http-equiv</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;refresh&#34;</span> <span style="color:#c4a000">content</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;0;URL=https://library.transparent.com/ohio&#34;</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">noscript</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">title</span><span style="color:#000;font-weight:bold">&gt;</span>Redirecting to Transparent Languages<span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">title</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;/</span><span style="color:#204a87;font-weight:bold">head</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#000;font-weight:bold">&lt;</span><span style="color:#204a87;font-weight:bold">script</span><span style="color:#000;font-weight:bold">&gt;</span><span style="color:#204a87">window</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">opener</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#204a87;font-weight:bold">null</span><span style="color:#000;font-weight:bold">;</span> <span style="color:#000">location</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">replace</span><span style="color:#000;font-weight:bold">(</span><span style="color:#4e9a06">&#34;https://library.transparent.com/ohio&#34;</span><span style="color:#000;font-weight:bold">)&lt;/</span><span style="color:#204a87;font-weight:bold">script</span><span style="color:#000;font-weight:bold">&gt;</span>
</span></span></code></pre></div><p>The SPU for Transparent Languages becomes:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-html" data-lang="html"><span style="display:flex;"><span>https://login.{EZproxy Hostname}/limited/transparent_languages.htm
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-77a56ba1626faf6846806ca300e5dfff">10 - fail2ban</h1>
    <div class="lead">Common fail2ban operations</div>
	<h2 id="common-commands">Common Commands</h2>
<ul>
<li>List Active Jails: <code>fail2ban-client status</code></li>
<li>Show Banned IPs in sshd Jail: <code>fail2ban-client status sshd</code></li>
<li>Manually Unban an IP from a Jail: <code>fail2ban-client set {jail name} unbanip {ip address}</code></li>
<li>Manually Ban an IP to a Jail: <code>fail2ban-client set {jail name} banip {ip address}</code></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4342c99a6ae391fcf2ac9f3495a2121d">11 - Git</h1>
    <div class="lead">Version control tool</div>
	<h1 id="configuration">Configuration</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git config
</span></span><span style="display:flex;"><span>git config --global user.name <span style="color:#4e9a06">&#34;derekz&#34;</span>
</span></span><span style="display:flex;"><span>git config --global user.email derekz@derekzoladz.com
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Remember my creds for 15 minutes</span>
</span></span><span style="display:flex;"><span>git config credential.helper cache
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Store my creds in a plain-text .git-credentials file</span>
</span></span><span style="display:flex;"><span>git config --global credential.helper store
</span></span></code></pre></div><h1 id="clone">Clone</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Clone a Repository and history</span>
</span></span><span style="display:flex;"><span>git clone https://github.com/dzoladz/dzoladz.git
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Clone &amp; Rename to &#39;website&#39;</span>
</span></span><span style="display:flex;"><span>git clone https://github.com/dzoladz/dzoladz.git website
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Clone a branch, &lt;branch&gt; &lt;remote repo&gt;</span>
</span></span><span style="display:flex;"><span>git clone -b collab/berick/ansible-installer-ubuntu-16.04  git://git.evergreen-ils.org/working/random.git
</span></span></code></pre></div><h1 id="basics">Basics</h1>
<h4 id="initialize-git-repository">Initialize Git Repository</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>mkdir repo_name
</span></span><span style="display:flex;"><span><span style="color:#204a87">cd</span> repo_name
</span></span><span style="display:flex;"><span>git init
</span></span></code></pre></div><h4 id="remotes">Remotes</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Add initial remote named &#39;origin&#39;</span>
</span></span><span style="display:flex;"><span>git remote add origin https://github.com/dzoladz/dzoladz.git
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Rename remote &#39;origin&#39; to &#39;upstream&#39;</span>
</span></span><span style="display:flex;"><span>git remote rename origin upstream
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># List all remotes</span>
</span></span><span style="display:flex;"><span>git remote -v
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Remote remote named &#39;upstream&#39;</span>
</span></span><span style="display:flex;"><span>git remote rm upstream
</span></span></code></pre></div><h4 id="files">Files</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># List new and modified files, branch, etc...</span>
</span></span><span style="display:flex;"><span>git status
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Track file.txt</span>
</span></span><span style="display:flex;"><span>git add file.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Add all untracked files to be staged for commit</span>
</span></span><span style="display:flex;"><span>git add .
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Show file differences between previous version and working version  </span>
</span></span><span style="display:flex;"><span>git diff
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Remove file.txt from staging for commit</span>
</span></span><span style="display:flex;"><span>git reset file.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Remove file.txt from tracking</span>
</span></span><span style="display:flex;"><span>git rm --cached file.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Undo act of commit</span>
</span></span><span style="display:flex;"><span>git reset --soft HEAD^
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Rename file.txt</span>
</span></span><span style="display:flex;"><span>git mv file.txt newfile.txt
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Commit tracked files to repo</span>
</span></span><span style="display:flex;"><span>git commit -m <span style="color:#4e9a06">&#34;COMMIT MESSAGE&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Push files to remote repository</span>
</span></span><span style="display:flex;"><span>git push &lt;remote_name&gt; &lt;branch_name&gt;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Incorporate changes from remote repository</span>
</span></span><span style="display:flex;"><span>git pull
</span></span></code></pre></div><h4 id="branches">Branches</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># List all branches in the local repository</span>
</span></span><span style="display:flex;"><span>git branch
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Show all local and remote branches</span>
</span></span><span style="display:flex;"><span>git branch -a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Create a branch named &#39;bugfix&#39;</span>
</span></span><span style="display:flex;"><span>git branch bugfix
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Switch to branch &#39;bugfix&#39;</span>
</span></span><span style="display:flex;"><span>git checkout bugfix
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Delete branch &#39;bugfix&#39;</span>
</span></span><span style="display:flex;"><span>git branch -d bugfix
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Merge bugfix into master</span>
</span></span><span style="display:flex;"><span>git checkout master <span style="color:#8f5902;font-style:italic"># local working master branch</span>
</span></span><span style="display:flex;"><span>git pull origin master <span style="color:#8f5902;font-style:italic"># incorporate remote updates</span>
</span></span><span style="display:flex;"><span>git merge bugfix <span style="color:#8f5902;font-style:italic"># merge changes into master</span>
</span></span><span style="display:flex;"><span>git push origin master <span style="color:#8f5902;font-style:italic"># push to remote</span>
</span></span></code></pre></div><h4 id="clean-up-a-dirty-pull">Clean up a dirty pull</h4>
<p>git stash
git pull origin master
git stash pop</p>
<h4 id="search-repo">Search Repo</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Case-insensitive search for files containing `commit`</span>
</span></span><span style="display:flex;"><span>git grep -i <span style="color:#4e9a06">&#39;commit&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># List files in repo using file globbing</span>
</span></span><span style="display:flex;"><span>git ls-files *.py
</span></span></code></pre></div><h4 id="history">History</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># List commit history of current branch</span>
</span></span><span style="display:flex;"><span>git log
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Show commit d2b557da6450c3dc77766b86d6d7b832af6d3d6a</span>
</span></span><span style="display:flex;"><span>git show d2b557da6450c3dc77766b86d6d7b832af6d3d6a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Show commits by specific author</span>
</span></span><span style="display:flex;"><span>git log --author<span style="color:#ce5c00;font-weight:bold">=</span>dzoladz
</span></span></code></pre></div><h1 id="just-for-fun">Just for Fun</h1>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Who has the most commits in this repo</span>
</span></span><span style="display:flex;"><span>git shortlog -s -n
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-b8c18d523022e4f3f97301e4a25f6183">12 - GPG</h1>
    <div class="lead">Using GPG for verified Git commits</div>
	<ol>
<li>Get <code>gpg</code> command</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew install gnupg
</span></span></code></pre></div><ol start="2">
<li>Generate GPG key</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gpg --full-generate-key
</span></span></code></pre></div><ol start="3">
<li>List GPG keys for <code>derek@derekzoladz.com</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gpg --list-secret-keys --keyid-format LONG derek@derekzoladz.com
</span></span></code></pre></div><ol start="4">
<li>Copy the GPG key ID that starts with <code>sec</code>. In the following example,
<code>488652B776349D07</code>:</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sec   rsa4096/488652B776349D07 2019-12-14 <span style="color:#ce5c00;font-weight:bold">[</span>SC<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>      8AAF3B17369BFB6A36171FFA76349D07488652B7
</span></span><span style="display:flex;"><span>uid                 <span style="color:#ce5c00;font-weight:bold">[</span>ultimate<span style="color:#ce5c00;font-weight:bold">]</span> Derek Zoladz <span style="color:#ce5c00;font-weight:bold">(</span>None<span style="color:#ce5c00;font-weight:bold">)</span> &lt;derek@derekzoladz.com&gt;
</span></span><span style="display:flex;"><span>ssb   rsa4096/8A3A7957EECFC9AA 2019-12-14 <span style="color:#ce5c00;font-weight:bold">[</span>E<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span></code></pre></div><ol start="5">
<li>Export the public key of that ID</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gpg --armor --export 488652B776349D07
</span></span></code></pre></div><ol start="6">
<li>
<p>Copy the public GPG key and it to both GitLab and GitHub accounts</p>
</li>
<li>
<p>Tell Git to use your GPG key to sign commits</p>
</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git config --global user.signingkey 488652B776349D07
</span></span></code></pre></div><ol start="8">
<li>Tell Git to sign your commits automatically, to avoid using the <code>-S</code> flag with every
commit</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>git config --global commit.gpgsign <span style="color:#204a87">true</span>
</span></span></code></pre></div><ol start="9">
<li>Export GPG key</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># temporary</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> <span style="color:#000">GPG_TTY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>tty<span style="color:#204a87;font-weight:bold">)</span>
</span></span></code></pre></div><p>-or-</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># add to .bashrc or .zshrc to load at each session</span>
</span></span><span style="display:flex;"><span><span style="color:#000">GPG_TTY</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87;font-weight:bold">$(</span>tty<span style="color:#204a87;font-weight:bold">)</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">export</span> GPG_TTY
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-edb5ffd6fb9449c40e4bfc1d024eb031">13 - Graphing Tool</h1>
    <div class="lead">Exploring various graphic utilities</div>
	<ul>
<li><a href="https://www.graphviz.org/documentation/">Graphviz Docs</a></li>
<li><a href="https://www.graphviz.org/doc/info/attrs.html">Graphviz Attribute Reference</a></li>
<li><a href="http://magjac.com/graphviz-visual-editor/">Web-based Visual Editor</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-87b868e5e394859d9f1f14a150a3a878">14 - Homebrew</h1>
    <div class="lead">MacOS Package Manager</div>
	<ol>
<li>Get it!</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/usr/bin/ruby -e <span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><h2 id="command-cheat-sheet">COMMAND CHEAT SHEET</h2>
<h4 id="globals">Globals</h4>
<ul>
<li><code>brew update</code>	update packages</li>
<li><code>brew list --versions</code>	show installed packages</li>
<li><code>brew cask list --versions</code>	show installed casks</li>
<li><code>brew doctor</code> check system for potential problems</li>
<li><code>brew help</code> print help info</li>
</ul>
<h4 id="packages">Packages</h4>
<ul>
<li><code>brew install hugo</code>	install package</li>
<li><code>brew uninstall hugo</code>	uninstall package</li>
<li><code>brew cask install atom</code>	install cask atom</li>
<li><code>brew upgrade hugo</code>	upgrade a package</li>
<li><code>brew switch hugo 0.5.3</code> switch package to specific version</li>
<li><code>brew info hugo</code>	list versions, caveats</li>
<li><code>brew cleanup hugo</code>	remove old versions</li>
<li><code>brew edit hugo</code>	edit formula</li>
<li><code>brew cat hugo</code>	print formula</li>
<li><code>brew home hugo</code>	open project homepage</li>
<li><code>brew pin hugo</code> prevent the specified formulae from being upgraded</li>
<li><code>brew unpin hugo</code> unpin package and allow upgrades</li>
</ul>
<h4 id="repos">Repos</h4>
<ul>
<li><code>brew search hugo</code> search repos based on the substring text.</li>
<li><code>brew tap myrepo/myapp</code> tap a personal repo with my own brew formula</li>
</ul>
<h4 id="services">Services</h4>
<ul>
<li><code>brew services start postgresql</code> start service</li>
<li><code>brew services restart postgresql</code> restart service</li>
<li><code>brew services stop postgresql</code> stop service</li>
<li><code>brew services list</code> list service statuses</li>
</ul>
<h4 id="hugo---install-specific-version">Hugo - Install Specific Version</h4>
<ol>
<li>Review commit logs and identify the commit for the version of Hugo you want to install</li>
</ol>
<ul>
<li><a href="https://github.com/Homebrew/homebrew-core/commits/master/Formula/hugo.rb">https://github.com/Homebrew/homebrew-core/commits/master/Formula/hugo.rb</a></li>
</ul>
<ol start="2">
<li>Add the commit to the shell script below and execute.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#!/usr/local/bin/bash
</span></span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"></span>
</span></span><span style="display:flex;"><span><span style="color:#000">FORMULA</span><span style="color:#ce5c00;font-weight:bold">=</span>hugo
</span></span><span style="display:flex;"><span><span style="color:#000">COMMIT</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#8f5902;font-style:italic">############</span>
</span></span><span style="display:flex;"><span><span style="color:#000">RAW_PATH</span><span style="color:#ce5c00;font-weight:bold">=</span>https://raw.githubusercontent.com/Homebrew/homebrew-core
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>brew unlink <span style="color:#4e9a06">${</span><span style="color:#000">FORMULA</span><span style="color:#4e9a06">}</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#4e9a06">\
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06"></span>brew install <span style="color:#4e9a06">${</span><span style="color:#000">RAW_PATH</span><span style="color:#4e9a06">}</span>/<span style="color:#4e9a06">${</span><span style="color:#000">COMMIT</span><span style="color:#4e9a06">}</span>/Formula/<span style="color:#4e9a06">${</span><span style="color:#000">FORMULA</span><span style="color:#4e9a06">}</span>.rb
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1c8c3e9fefdae28d6744f4228674e642">15 - JS Forms</h1>
    <div class="lead">Solution snippets for EBSCO EDS</div>
	<h2 id="ebsco">EBSCO</h2>
<ul>
<li>Article Search</li>
</ul>
<pre tabindex="0"><code>&lt;form action=&#34;javascript:submitArticleDatabasesSearch();&#34;&gt;
	&lt;label for=&#34;searchbox&#34;&gt;Search for:&lt;/label&gt;
	&lt;input name=&#34;article_searchbox&#34; type=&#34;text&#34; placeholder=&#34;Enter Keywords&#34;&gt;
	&lt;span class=&#34;search-in&#34;&gt;
		&lt;label for=&#34;database&#34; class=&#34;libdata in&#34;&gt;in&lt;/label&gt;
		&lt;select name=&#34;database&#34;&gt;
			&lt;option disabled=&#34;disabled&#34; value=&#34;&#34;&gt;Choose a Database&lt;/option&gt;
			&lt;option value=&#34;a9h&#34;&gt;Academic Search Complete&lt;/option&gt;
			&lt;option value=&#34;jstor&#34;&gt;JSTOR&lt;/option&gt;
		&lt;/select&gt;
	&lt;/span&gt;
	&lt;input name=&#34;article_search_submit&#34; type=&#34;submit&#34; value=&#34;Search&#34;&gt;
&lt;/form&gt;

&lt;script&gt;
function submitArticleDatabasesSearch() {
	const proxyPrefix = &#34;https://YOUREZPROXYDOMAINHERE/login?url=&#34;;
	var selected = document.getElementsByName(&#39;database&#39;)[0].value;
	var terms = document.getElementsByName(&#39;article_searchbox&#39;)[0].value;

	if (selected != &#34;&#34;) {
		console.log(&#34;Okay&#34;);
		if (selected == &#34;a9h&#34;) {
			console.log(&#34;User selected: &#34; + selected);
			const ebscoPrefix = &#34;https://search.ebscohost.com/login.aspx?direct=true&amp;scope=site&amp;type=1&amp;site=ehost-live&amp;db=a9h&amp;lang=en&amp;authtype=cookie,ip&amp;ssl=Y&amp;&amp;bquery=&#34;
			window.location.assign(proxyPrefix + ebscoPrefix + terms)
		} else if (selected == &#34;jstor&#34;) {
			console.log(&#34;User selected: &#34; + selected);
			const jstorPrefix = &#34;https://www.jstor.org/action/doAdvancedSearch?q0=&#34;
			window.location.assign(proxyPrefix + jstorPrefix + terms)
		} else {
			console.log(&#34;Unexpected value for select option&#34;)
		}
	} else {
		return false;
	}
}
&lt;/script&gt;
</code></pre><ul>
<li>OneSearch</li>
</ul>
<pre tabindex="0"><code>&lt;form action=&#34;javascript:submitOneSearch()&#34;&gt;

	&lt;select id=&#34;search-field&#34; name=&#34;search_prefix&#34;&gt;
		&lt;option selected=&#34;selected&#34; value=&#34;&#34;&gt;Keyword&lt;/option&gt;
		&lt;option value=&#34;TI&#34;&gt;Title&lt;/option&gt;
		&lt;option value=&#34;AU&#34;&gt;Author&lt;/option&gt;
	&lt;/select&gt;

	&lt;input name=&#34;bquery&#34; type=&#34;text&#34; placeholder=&#34;Enter keywords&#34; value=&#34;&#34;&gt;
	&lt;input type=&#34;submit&#34; value=&#34;Search&#34;&gt;&lt;br&gt;
	&lt;input id=&#34;fulltext_checkbox_all&#34; name=&#34;fulltext_checkbox&#34; type=&#34;checkbox&#34; class=&#34;check&#34;&gt;
	&lt;label for=&#34;fulltext_checkbox_all&#34;&gt;Full-Text (online)&lt;/label&gt;
	&lt;input id=&#34;scholarly_checkbox_articles&#34; name=&#34;scholarly_checkbox&#34; type=&#34;checkbox&#34; class=&#34;check&#34;&gt;
	&lt;label for=&#34;scholarly_checkbox_articles&#34;&gt;Scholarly (Peer Reviewed)&lt;/label&gt;
&lt;/form&gt;

&lt;script&gt;
	function submitOneSearch() {
		const proxyPrefix = &#34;https://YOUREZPROXYDOMAINHERE/login?url=&#34;;
		const edsProfile = &#34;http://search.ebscohost.com/login.aspx?direct=true&amp;scope=site&amp;site=edslive&amp;profile=eds&amp;authtype=ip,cookie,guest,url,uid&amp;custid=s9003022&amp;groupid=main&amp;&#34;;
		var search_field = document.getElementsByName(&#39;search_prefix&#39;)[0].value;
		var limit_ft = document.getElementsByName(&#39;fulltext_checkbox&#39;)[0].checked;
		var limit_rv = document.getElementsByName(&#39;scholarly_checkbox&#39;)[0].checked;
		var search_terms = document.getElementsByName(&#39;bquery&#39;)[0].value;

		// Toggle Full-Text Limiter
		if (limit_ft == true) {
			console.log(&#34;Enable FT Limiter&#34;);
			ft = &#34;cli0=FT&amp;clv0=Y&#34;;
		} else {
			console.log(&#34;Disable FT Limiter&#34;)
			ft = &#34;cli0=FT&amp;clv0=N&#34;;
		}

		// Toggle Scholarly Atricles Limiter
		if (limit_rv == true) {
			console.log(&#34;Enable RV Limiter&#34;);
			rv = &#34;cli1=RV&amp;clv1=Y&#34;;
		} else {
			console.log(&#34;Disable RV Limiter&#34;);
			rv = &#34;cli1=RV&amp;clv1=N&#34;;
		}

		// Build Search Type
		if (search_field != &#34;&#34;) {
			type = &#34;search_field=&#34; + search_field
		} else {
			type = &#34;search_field=&#34;
		}

		window.location.assign(proxyPrefix + edsProfile + type + &#34;&amp;&#34; + ft + &#34;&amp;&#34; + rv + &#34;&amp;bquery=&#34; + search_terms)

	}
&lt;/script&gt;
</code></pre>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9f24a04f29e3f43c63967cbfaf5d2127">16 - LVM</h1>
    <div class="lead">Working with the Logical Volume Manager</div>
	<p><img src="../img/lvm_diagram.png" alt="LVM Diagram"></p>
<h4 id="references">References</h4>
<ul>
<li><a href="https://www.kernel.org/doc/Documentation/admin-guide/devices.txt">Kernel Device Naming</a></li>
<li><a href="https://tldp.org/HOWTO/LVM-HOWTO/anatomy.html">LVM Anatomy</a></li>
</ul>
<h4 id="lvm-storage-management-is-divided-into-three-parts">LVM Storage Management is divided into three parts:</h4>
<ul>
<li><strong>Physical Volumes (PV)</strong> – Actual disks or disk partitions (e.g. /dev/sda, /dev/sda2)</li>
<li><strong>Volume Groups (VG)</strong> – Physical volumes are combined into volume groups. (e.g. VolGroup1 = /dev/sda + /dev/sdb2)</li>
<li><strong>Logical Volumes (LV)</strong> – Volume groups are divided into logical volumes (e.g. VolGroup1 = LogicalVol1/data, LogicalVol2/home)</li>
</ul>
<h4 id="commands">Commands</h4>
<p>Display Disk Information</p>
<ul>
<li><code>fdisk -l</code></li>
</ul>
<p>Display LVM Mapping</p>
<ul>
<li><code>lvmdiskscan</code></li>
</ul>
<p>Display Physical Volumes</p>
<ul>
<li><code>pvs</code></li>
<li><code>pvdisplay</code></li>
</ul>
<p>Display Volume Groups</p>
<ul>
<li><code>vgs</code></li>
<li><code>vgdisplay</code></li>
</ul>
<p>Display Logical Volumes</p>
<ul>
<li><code>lvs</code></li>
<li><code>lvdisplay</code></li>
</ul>
<hr>
<p>STEPS</p>
<ol>
<li>Run LVM Scan to determine available disks - <code>lvmdiskscan</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>root@hostname:/# lvmdiskscan
</span></span><span style="display:flex;"><span>  /dev/VolGroup1/LogicalVol1 [       3.72 GiB]
</span></span><span style="display:flex;"><span>  /dev/sda1                  [     285.00 MiB]
</span></span><span style="display:flex;"><span>  /dev/VolGroup1/LogicalVol2 [       3.72 GiB]
</span></span><span style="display:flex;"><span>  /dev/VolGroup1/LogicalVol3 [     &lt;20.49 GiB]
</span></span><span style="display:flex;"><span>  /dev/VolGroup1/LogicalVol4 [      16.76 GiB]
</span></span><span style="display:flex;"><span>  /dev/VolGroup1/LogicalVol5 [      18.62 GiB]
</span></span><span style="display:flex;"><span>  /dev/sda5                  [     &lt;79.72 GiB] LVM physical volume
</span></span><span style="display:flex;"><span>  /dev/VolGroup1/LogicalVol0 [      &lt;7.45 GiB]
</span></span><span style="display:flex;"><span>  /dev/sdb                   [      40.00 GiB]
</span></span><span style="display:flex;"><span>  1 disk
</span></span><span style="display:flex;"><span>  7 partitions
</span></span><span style="display:flex;"><span>  0 LVM physical volume whole disks
</span></span><span style="display:flex;"><span>  1 LVM physical volume
</span></span></code></pre></div><ol start="2">
<li>Establish another Physical Volume (PV) for the newly installed SCSI disk /dev/sbd - <code>pvcreate</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>root@hostname:/# pvcreate /dev/sdb
</span></span><span style="display:flex;"><span>  Physical volume &#34;/dev/sdb&#34; successfully created.
</span></span></code></pre></div><ol start="3">
<li>List available Volume Groups (VG) - <code>vgs</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>root@hostname:/# vgs
</span></span><span style="display:flex;"><span>  VG        #PV #LV #SN Attr   VSize  VFree
</span></span><span style="display:flex;"><span>  VolGroup1   1   6   0 wz--n- 79.71g &lt;8.95g
</span></span></code></pre></div><ol start="4">
<li>Add new PV to current VG (VolGroup1) - <code>vgextend</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>root@hostname:/# vgextend VolGroup1 /dev/sdb
</span></span><span style="display:flex;"><span>  Volume group &#34;VolGroup1&#34; successfully extended
</span></span></code></pre></div><ol start="5">
<li>Find the Logical Volume to extend - <code>lsblk</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>root@hostname:/# lsblk
</span></span><span style="display:flex;"><span>NAME                      MAJ:MIN RM  SIZE RO TYPE MOUNTPOINT
</span></span><span style="display:flex;"><span>fd0                         2:0    1    4K  0 disk
</span></span><span style="display:flex;"><span>sda                         8:0    0   80G  0 disk
</span></span><span style="display:flex;"><span>├─sda1                      8:1    0  285M  0 part /boot
</span></span><span style="display:flex;"><span>├─sda2                      8:2    0    1K  0 part
</span></span><span style="display:flex;"><span>└─sda5                      8:5    0 79.7G  0 part
</span></span><span style="display:flex;"><span>  ├─VolGroup1-LogicalVol1 253:0    0  3.7G  0 lvm  /
</span></span><span style="display:flex;"><span>  ├─VolGroup1-LogicalVol2 253:1    0  3.7G  0 lvm  /tmp
</span></span><span style="display:flex;"><span>  ├─VolGroup1-LogicalVol3 253:2    0 20.5G  0 lvm  /usr
</span></span><span style="display:flex;"><span>  ├─VolGroup1-LogicalVol4 253:3    0 46.8G  0 lvm  /var
</span></span><span style="display:flex;"><span>  ├─VolGroup1-LogicalVol5 253:4    0 18.6G  0 lvm  /home
</span></span><span style="display:flex;"><span>  └─VolGroup1-LogicalVol0 253:5    0  7.5G  0 lvm  [SWAP]
</span></span><span style="display:flex;"><span>sdb                         8:16   0   40G  0 disk
</span></span><span style="display:flex;"><span>└─VolGroup1-LogicalVol4   253:3    0 46.8G  0 lvm  /var
</span></span><span style="display:flex;"><span>sr0                        11:0    1 1024M  0 rom
</span></span></code></pre></div><ol start="6">
<li>Extend the logical volume by 30GB - <code>lvextend</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>root@hostname:/# lvextend -L+30G /dev/VolGroup1/LogicalVol4
</span></span><span style="display:flex;"><span>  Size of logical volume VolGroup1/LogicalVol4 changed from 16.76 GiB (4291 extents) to 46.76 GiB (11971 extents).
</span></span><span style="display:flex;"><span>  Logical volume VolGroup1/LogicalVol4 successfully resized.
</span></span></code></pre></div><p>It&rsquo;s also possible to <em><strong>extend the logical volume to an exact size</strong></em>, using <code>lvextend -L50G /dev/VolGroup1/LogicalVol4</code> would expand the LV to 50GB</p>
<ol start="7">
<li>Extend the file system on <code>/dev/VolGroup1/LogicalVol4</code> to include the new storage capacity - <code>resize2fs</code></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-text" data-lang="text"><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>root@hostname:/# resize2fs /dev/VolGroup1/LogicalVol4
</span></span><span style="display:flex;"><span>resize2fs 1.44.1 (24-Mar-2018)
</span></span><span style="display:flex;"><span>Filesystem at /dev/VolGroup1/LogicalVol4 is mounted on /var; on-line resizing required
</span></span><span style="display:flex;"><span>old_desc_blocks = 2, new_desc_blocks = 3
</span></span><span style="display:flex;"><span>The filesystem on /dev/VolGroup1/LogicalVol4 is now 12258304 (4k) blocks long.
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-66b757734131fa5bcd4bc6aebee1d53f">17 - Mailman</h1>
    <div class="lead">A few commonly used mailman commands to make my life more enjoyable. Find binaries in <code>/usr/lib/mailman/bin</code></div>
	<h2 id="mailman-operator-binaries">Mailman Operator Binaries</h2>
<ol>
<li>
<p>Remove an email address from all lists on the server
<code>remove_members --fromall --nouserack username@domain.edu</code></p>
</li>
<li>
<p>Add a single user to a list
<code>echo 'username@domain.edu' | add_members -r - listname</code></p>
</li>
<li>
<p>List Membership
<code>list_members listname</code></p>
</li>
<li>
<p>Export Member List for Migration
<code>list_members --fullnames -o membership.txt listname</code></p>
</li>
<li>
<p>List All Mailing Lists
<code>list_lists</code></p>
</li>
<li>
<p>Find a Member in All Lists
<code>find_member username@domain.edu</code></p>
</li>
</ol>
<h2 id="migration-tasks">Migration Tasks</h2>
<p>Mailman provides a few scripts to assist with migration tasks. Check out those scripts to see if something is already available for a specific task before using the one-liners below.</p>
<ol>
<li>Move List Archives to Another Server</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>scp -r /path/to/list_archive user@mailman.example.org:/var/lib/mailman/archives/private/list_archive
</span></span></code></pre></div><ol start="2">
<li>Fix the Hostname in <code>*.html</code> Archive Files</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>find . -type f -name <span style="color:#4e9a06">&#34;*.html&#34;</span> -print0 <span style="color:#000;font-weight:bold">|</span> xargs -0 sed -e <span style="color:#4e9a06">&#39;s/list.ohionet.org/lists.ohionet.org/g&#39;</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-360ce071c494917ed482e511bb393a68">18 - Monit</h1>
    <div class="lead">Monitor files, directories, processes, CPU, and other systems protocols</div>
	<p><a href="https://mmonit.com/monit/">website</a></p>
<p><a href="https://mmonit.com/wiki/Monit/ConfigurationExamples">configuration examples</a></p>
<h2 id="setup-notes">Setup Notes</h2>
<p>You&rsquo;ll need to ensure that the standard mailutils are installed on the server.</p>
<pre tabindex="0"><code>apt-get install postfix mailutils
</code></pre><p>Afterwards, modify the <code>/etc/monit/monitrc</code> file by uncommenting the following lines to enable emailed notifications</p>
<pre tabindex="0"><code>set mailserver localhost  #Use localhost for email delivery.

set mail-format {
      from: monit@$HOST
   subject: monit alert --  $EVENT $SERVICE
   message: $EVENT Service $SERVICE
                 Date:        $DATE
                 Action:      $ACTION
                 Host:        $HOST
                 Description: $DESCRIPTION
}

set alert derekz@example.org #Alert recipient
</code></pre><p>If you want to store notifications for dispatch, you&rsquo;ll need to enable the notifications queue.</p>
<pre tabindex="0"><code>set eventqueue
	basedir /var/lib/monit/events # notifications store
	slots 100                     # limit the queue size
</code></pre><p>I don&rsquo;t need to be informed when the instance state has changed or reloaded, so I silence those alerts by uncommenting this <code>instance</code> filter</p>
<pre tabindex="0"><code>## Do not alert when Monit starts, stops or performs a user initiated action.
 set alert derekz@example.org not on {instance}
</code></pre><p>Make sure to comment out any include file directories at the end of <code>/etc/monit/monitrc</code>. If a path is in the configuration file, but the file does not exist, monit will fail to start.</p>
<h2 id="commands">Commands</h2>
<h5 id="monit-daemon">Monit Daemon</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>monit
</span></span><span style="display:flex;"><span>monit reload
</span></span><span style="display:flex;"><span>monit status
</span></span><span style="display:flex;"><span>monit quit
</span></span></code></pre></div><h5 id="test-configuration">Test Configuration</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>monit -t
</span></span></code></pre></div><h5 id="controlling-monitors">Controlling Monitors</h5>
<pre tabindex="0"><code>monit unmonitor all
monit monitor all
</code></pre><h2 id="alerts">Alerts</h2>
<h5 id="alert-if-new-marc-files-are-added-or-removed-from-a-directory">Alert if new MARC files are added or removed from a directory</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>check directory marcfiles with path /home/admin/marc/
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">if</span> changed timestamp <span style="color:#204a87;font-weight:bold">then</span> alert
</span></span></code></pre></div><h5 id="alert-if-registered-users-file-has-not-been-updated-in-the-past-24-hours">Alert if registered users file has not been updated in the past 24 hours</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>check directory registeredusers with path /home/admin/users
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">if</span> timestamp &gt; <span style="color:#0000cf;font-weight:bold">24</span> hour <span style="color:#204a87;font-weight:bold">then</span> alert
</span></span></code></pre></div><h5 id="call-home-every-500-cycles">Call home every 500 cycles</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>check file testalert with path /.nonexistent
</span></span><span style="display:flex;"><span>    alert derek@example.com with reminder on <span style="color:#0000cf;font-weight:bold">500</span> cycles
</span></span></code></pre></div><h5 id="alert-on-low-disk-space">Alert on low disk space</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>check filesystem rootfs with path /
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> space usage &gt; 90% <span style="color:#204a87;font-weight:bold">then</span> alert
</span></span></code></pre></div><h5 id="monitor-system-load">Monitor System Load</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>check system example.com
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> loadavg <span style="color:#ce5c00;font-weight:bold">(</span>1min<span style="color:#ce5c00;font-weight:bold">)</span> &gt; <span style="color:#0000cf;font-weight:bold">4</span> <span style="color:#204a87;font-weight:bold">then</span> alert
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> loadavg <span style="color:#ce5c00;font-weight:bold">(</span>5min<span style="color:#ce5c00;font-weight:bold">)</span> &gt; <span style="color:#0000cf;font-weight:bold">2</span> <span style="color:#204a87;font-weight:bold">then</span> alert
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> memory usage &gt; 75% <span style="color:#204a87;font-weight:bold">then</span> alert
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> swap usage &gt; 25% <span style="color:#204a87;font-weight:bold">then</span> alert
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> cpu usage <span style="color:#ce5c00;font-weight:bold">(</span>user<span style="color:#ce5c00;font-weight:bold">)</span> &gt; 70% <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#0000cf;font-weight:bold">2</span> cycles <span style="color:#204a87;font-weight:bold">then</span> alert
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> cpu usage <span style="color:#ce5c00;font-weight:bold">(</span>system<span style="color:#ce5c00;font-weight:bold">)</span> &gt; 30% <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#0000cf;font-weight:bold">2</span> cycles <span style="color:#204a87;font-weight:bold">then</span> alert
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> cpu usage <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87">wait</span><span style="color:#ce5c00;font-weight:bold">)</span> &gt; 20% <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#0000cf;font-weight:bold">2</span> cycles <span style="color:#204a87;font-weight:bold">then</span> alert
</span></span></code></pre></div><h5 id="double-check-the-automated-lets-encrypt-ssl-renewal-process">Double check the automated Let&rsquo;s Encrypt SSL renewal process</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>check host mmonit.com with address mmonit.com
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">if</span> failed
</span></span><span style="display:flex;"><span>         port <span style="color:#0000cf;font-weight:bold">443</span>
</span></span><span style="display:flex;"><span>         with protocol https
</span></span><span style="display:flex;"><span>         and certificate valid &gt; <span style="color:#0000cf;font-weight:bold">30</span> days
</span></span><span style="display:flex;"><span>         use ssl options <span style="color:#ce5c00;font-weight:bold">{</span>verify: enable<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">then</span> alert
</span></span></code></pre></div><h5 id="restart-ezproxy-if-service-halts">Restart EZproxy, if service halts</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>check process ezproxy with pidfile /var/run/ezproxy.pid
</span></span><span style="display:flex;"><span>      restart <span style="color:#000">program</span>  <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#4e9a06">&#34;/usr/local/ezproxy/ezproxy restart&#34;</span>
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">if</span> failed port <span style="color:#0000cf;font-weight:bold">80</span> protocol http <span style="color:#204a87;font-weight:bold">for</span> <span style="color:#0000cf;font-weight:bold">2</span> cycles <span style="color:#204a87;font-weight:bold">then</span> restart
</span></span></code></pre></div><h5 id="alert-on-apache-timeouts">Alert on Apache Timeouts</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>check file apache-error with path /var/log/apache2/error.log
</span></span><span style="display:flex;"><span>    <span style="color:#204a87;font-weight:bold">if</span> match <span style="color:#4e9a06">&#34;^timed out&#34;</span> <span style="color:#204a87;font-weight:bold">then</span> alert
</span></span></code></pre></div><h5 id="process-patrons-when-a-new-file-is-uploaded">Process patrons when a new file is uploaded</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>check directory patrons with path /home/admin/patrons/
</span></span><span style="display:flex;"><span>      <span style="color:#204a87;font-weight:bold">if</span> changed timestamp <span style="color:#204a87;font-weight:bold">then</span> <span style="color:#204a87">exec</span> <span style="color:#4e9a06">&#34;/home/admin/scripts/process-patrons.py&#34;</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1066e9965c05de85e8ca18c881b85e50">19 - networker</h1>
    <div class="lead">Networker Commands</div>
	

<div class="alert alert-warning" role="alert">
<h4 class="alert-heading">Warning</h4>

    Moved to Commvault

</div>

<h2 id="service">Service</h2>
<p>Daemon is <code>nsrexecd</code></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>service networker stop
</span></span><span style="display:flex;"><span>service networker start
</span></span></code></pre></div><h2 id="logging">Logging</h2>
<p>Logging for previous versions of Networker configured logs to <code>/nsr/logs/daemon.raw</code></p>
<h4 id="enter-administrative-shell-of-networker">Enter Administrative Shell of Networker</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nsradmin -p nsrexec
</span></span></code></pre></div><h4 id="render-log-from-raw">Render <code>.log</code> from <code>.raw</code></h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">cd</span> /nsr/logs/
</span></span><span style="display:flex;"><span>nsr_render_log -mepathy daemon.raw &gt; daemon.log
</span></span></code></pre></div><h4 id="view-most-recent-25-entries-in-log">View most recent 25 entries in log</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tail -n <span style="color:#0000cf;font-weight:bold">25</span> daemon.log
</span></span></code></pre></div><h4 id="view-logging-configuration">View logging configuration</h4>
<p>From <code>nsradmin</code> shell:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>print type: NSR log
</span></span></code></pre></div><h4 id="update-runtime-loggging-location">Update Runtime Loggging Location</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>update runtime rendered log:/nsr/logs/daemon.log
</span></span></code></pre></div><h4 id="configure-master-server-at-nsrresservers">Configure master server at <code>/nsr/res/servers</code></h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#204a87">echo</span> <span style="color:#4e9a06">&#34;[backup server domain]&#34;</span> &gt;&gt; /nsr/res/servers
</span></span></code></pre></div><h2 id="connection-issue">Connection Issue</h2>
<p>Render <code>daemon.raw</code> and check latest entries.</p>
<h4 id="refresh-networker">Refresh Networker</h4>
<ol>
<li>Stop Networker service</li>
<li>Rename &ldquo;res&rdquo; to &ldquo;res.old&rdquo;</li>
<li>Rename &ldquo;tmp&rdquo; to &ldquo;tmp.old&rdquo;</li>
<li>Start Networker service</li>
<li>Move &ldquo;res.old/servers&rdquo; to &ldquo;res/servers&rdquo;</li>
</ol>
<h4 id="fresh-install">Fresh Install</h4>
<ol>
<li>Navigate to the location of the <code>.deb</code></li>
<li><code>sudo apt install ./networker_client.deb</code></li>
</ol>
<h4 id="reset-peer-information">Reset Peer Information</h4>
<p>From <code>nsradmin</code> shell</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>print type: nsr peer information
</span></span><span style="display:flex;"><span>delete
</span></span></code></pre></div><h2 id="external-links">External Links</h2>
<p><a href="www.ipnom.com/legato-NetWorker-Commands">Legato Commands</a></p>
<p><a href="https://www.emc.com/collateral/TechnicalDocument/docu53903.pdf">EMC NetWorker 8.2 Admin Guide</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-0a7bef099b83bb4e8423d6b11e27685b">20 - Networking</h1>
    <div class="lead">Notating useful networking commands, tasks, or related discoveries.</div>
	<h2 id="google-cloud">Google Cloud</h2>
<p>Installing the SDK <a href="https://cloud.google.com/sdk/docs/">https://cloud.google.com/sdk/docs/</a></p>
<h4 id="a-few-commands-for-migrating-a-dns-zone">A Few Commands for Migrating a DNS zone</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>gcloud auth login --project managed-dns-migration
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud dns managed-zones create myzone --dns-name<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;myzone.org&#34;</span> --description<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;Zone for all the things&#34;</span> --visibility<span style="color:#ce5c00;font-weight:bold">=</span>public
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud dns record-sets import -z<span style="color:#ce5c00;font-weight:bold">=</span>myzone --zone-file-format /path/to/zonefile/myzone.org.zonefile.txt --delete-all-existing
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>gcloud dns managed-zones describe myzone
</span></span></code></pre></div><h2 id="dns">DNS</h2>
<p>General DNS commands</p>
<h4 id="dig">dig</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Query Cloudflare primary DNS to reply with the name servers for the cool-cat.org domain</span>
</span></span><span style="display:flex;"><span>dig +short NS cool-cat.org 1.1.1.1
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Ask for the name servers every 2 seconds. Useful for monitoring propagation</span>
</span></span><span style="display:flex;"><span>watch dig +short NS cool-cat.org 1.1.1.1
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-9f11946e110fe4b06c0064964424e26b">21 - Packages</h1>
    <div class="lead">🤷 Linux package management</div>
	<h2 id="intro">Intro</h2>
<h4 id="what-is-a-package">What is a Package?</h4>
<p>An archive file format containing source code, executable files, and metadata used by a package manager.</p>
<h4 id="what-is-a-package-manager">What is a Package Manager?</h4>
<p>A tool to manage installed applications, automatically compute dependencies, and figure out what things should occur to install packages.</p>
<h2 id="debian-based-debian-ubuntu">Debian-based (Debian, Ubuntu)</h2>
<h4 id="package-format">Package Format</h4>
<p>.deb package format
.snap (single, compressed filesystem)</p>
<h4 id="package-manager">Package Manager</h4>
<p>dpkg - can install .deb directly
apt - works with software repos</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Example - Search for a linux-image and install it.</span>
</span></span><span style="display:flex;"><span>apt search linux-image <span style="color:#000;font-weight:bold">|</span> grep linux-image-4.18.0-22-generic
</span></span><span style="display:flex;"><span>apt install linux-image-4.18.0-22-generic
</span></span><span style="display:flex;"><span>update-grub
</span></span><span style="display:flex;"><span>reboot
</span></span></code></pre></div><h2 id="redhat-based-fedora-centos-amazon-linux">RedHat-based (Fedora, CentOS, Amazon Linux)</h2>
<h4 id="package-format-1">Package format</h4>
<p>.rpm package format</p>
<h4 id="package-manager-1">Package Manager</h4>
<p><a href="http://yum.baseurl.org/">yum</a> - works with software repos
<a href="https://dnf.readthedocs.io/en/latest/">dnf</a></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fcebe50774b0c7ff0550bb1893f7c7f8">22 - Perlbrew</h1>
    <div class="lead">MacOS Perl Installation Manager</div>
	<ol>
<li>Get it</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>curl -L https://install.perlbrew.pl <span style="color:#000;font-weight:bold">|</span> bash
</span></span></code></pre></div><ol start="2">
<li>Add <code>perlbrew</code> to your PATH</li>
</ol>
<h2 id="command-cheat-sheet">COMMAND CHEAT SHEET</h2>
<h4 id="initialize">Initialize</h4>
<ul>
<li><code>perlbrew init</code></li>
</ul>
<h4 id="get-crackn">Get Crack&rsquo;n</h4>
<ul>
<li><code>perlbrew available</code></li>
<li><code>perlbrew install 5.30.0</code></li>
<li><code>perlbrew list</code></li>
<li><code>perlbrew switch 5.30.0</code> &gt; set as default</li>
</ul>
<h4 id="turn-it-off-completely-useful-when-you-messed-up-too-deep">Turn it off completely. Useful when you messed up too deep.</h4>
<p>-<code>perlbrew off</code></p>
<h4 id="install-cpanm--a-script-to-get-unpack-build-and-install-modules-from">Install <code>cpanm</code> | a script to get, unpack, build and install modules from</h4>
<p>CPAN.</p>
<ul>
<li><code>perlbrew install-cpanm</code></li>
<li><code>cpanm Module::Name</code></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-93a572212945aac4962b87f6a08892b2">23 - Postfix</h1>
    <div class="lead">Working with postfix mail transfer agent (MTA)</div>
	<p><img src="../img/postfix-integrations.png" alt="Postfix Diagram"></p>
<h1 id="blacklist--whitelist-with-postfix">Blacklist &amp; Whitelist with Postfix</h1>
<h3 id="1-create-a-file-of-ips-to-blacklist---postfix-referencehttpwwwpostfixorgcidr_table5html">1. Create a file of IPs to blacklist - <a href="http://www.postfix.org/cidr_table.5.html">Postfix Reference</a></h3>
<p>Create a <code>reject.cidr</code> file in <code>/etc/postfix</code>. To it, add one or more problematic IPs or ranges from your logwatch reports, mail logs, email headers, etc.:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>192.168.1.1     OK
</span></span><span style="display:flex;"><span>192.168.0.0/16	REJECT
</span></span><span style="display:flex;"><span>2001:db8::1		OK
</span></span><span style="display:flex;"><span>2001:db8::/32	REJECT
</span></span></code></pre></div><p><strong>FROM THE DOCS</strong> - <em>Rule order matters! Place specific whitelist entries before general blacklist entries.</em></p>
<h3 id="2-hash-the-rejectcidr-file---postfix-referencehttpwwwpostfixorgpostmap1html">2. Hash the <code>reject.cidr</code> file - <a href="http://www.postfix.org/postmap.1.html">Postfix Reference</a></h3>
<p>The <code>reject.cidr</code> file must be converted to a database that Postfix can read. This must be done every time <code>reject.cidr</code> is updated.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>postmap /etc/postfix/reject.cidr
</span></span></code></pre></div><h3 id="3-update-etcpostfixmaincf---postfix-referencehttpwwwpostfixorgaccess5html">3. Update <code>/etc/postfix/main.cf</code> - <a href="http://www.postfix.org/access.5.html">Postfix Reference</a></h3>
<p>Postfix needs to be made aware of the new IP blacklist. To alert Postfix of the blacklist, you&rsquo;ll need to add the following to <code>main.cf</code>. - <a href="http://www.postfix.org/postconf.5.html#smtpd_client_restrictions">Postfix Reference</a></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#000">smtpd_recipient_restrictions</span> <span style="color:#ce5c00;font-weight:bold">=</span>
</span></span><span style="display:flex;"><span>   check_client_access cidr:/etc/postfix/reject.cidr
</span></span></code></pre></div><p><strong>FROM THE DOCS</strong> - Placing a block list at the beginning of the <code>smtpd_recipient_restrictions</code> parameter ensures that the IP blocks are obeyed above all other processing, but just as importantly, prevents more-expensive operations, such as virus scanning and spam scoring, from running when the outcome is predetermined.</p>
<h3 id="4-reload-the-postfix-configuration">4. Reload the Postfix configuration</h3>
<p>Execute the following command</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/etc/init.d/postfix reload
</span></span></code></pre></div><h3 id="5-check-the-postfix-log">5. Check the Postfix log</h3>
<p>Check <code>mail.log</code> to confirm that there weren’t any errors reading the new configuration. The following command should be sufficient in most cases.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>tail -n <span style="color:#0000cf;font-weight:bold">20</span> /var/log/mail.log
</span></span></code></pre></div><h2 id="taking-it-further">Taking it Further</h2>
<p>There are two parameters we can set in postfix, which acts differently.</p>
<ul>
<li><code>check_client_access</code> : Block by client IP, client IP range or Hostname</li>
<li><code>check_sender_access</code> : Block by sender e-mail address (FROM field)</li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-d46f9035d465ecc234a3d5d560fb7dcf">24 - PostgreSQL</h1>
    <div class="lead">Installation on MacOS using Homebrew services</div>
	<h2 id="first-steps">First Steps</h2>
<ol>
<li>Install PostgreSQL, preferably a pinned version</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew install postgresql@10
</span></span></code></pre></div><ol start="2">
<li>If you don&rsquo;t have one, get the <code>psql</code> client.</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew install libpq
</span></span></code></pre></div><blockquote>
<p><code>libpq</code> won&rsquo;t install itself in the <code>/usr/local/bin</code> directory like other Homebrew applications. To make that happen, you need to run:</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew link --force libpq
</span></span></code></pre></div><ol start="3">
<li>Start Postgres services</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew services start postgresql
</span></span></code></pre></div><blockquote>
<p>Check <code>brew info postgresql</code></p>
</blockquote>
<ol start="4">
<li>Create a database, and&hellip;</li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>createdb <span style="color:#4e9a06">`</span>first<span style="color:#4e9a06">`</span>
</span></span></code></pre></div><blockquote>
<p>Fix role &ldquo;postgres&rdquo; does not exist error</p>
</blockquote>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>createuser -s postgres
</span></span></code></pre></div><h2 id="initial-reading">Initial Reading</h2>
<p><a href="http://postgresguide.com/">PostgreSQL Guide</a></p>
<h2 id="psql">PSQL</h2>
<ul>
<li>Run psql client as user postgres - <code>psql -U postgres</code></li>
<li>Connect to local postgres database as a specific user - `psql -h localhost -U &lt;postgres_user&gt; <database>``</li>
</ul>
<h4 id="quick-start">Quick Start</h4>
<ul>
<li><code>\?</code> - List all available commands</li>
<li><code>\q</code> - Quit/Exit</li>
<li><code>\l</code> - List databases</li>
<li><code>\c &lt;database&gt;</code> - Connect to a database</li>
</ul>
<h4 id="up-and-running-informational">Up and Running, Informational</h4>
<ul>
<li>
<p><code>\d</code> - List tables</p>
</li>
<li>
<p><code>\d &lt;table&gt;</code> - Show table definition, including triggers</p>
</li>
<li>
<p><code>\d+ &lt;table&gt;</code> - Show additional info about a table</p>
</li>
<li>
<p><code>\dy</code> - List events</p>
</li>
<li>
<p><code>\df</code> - List functions</p>
</li>
<li>
<p><code>\di</code> - List indexes</p>
</li>
<li>
<p><code>\dn</code> - List schemas</p>
</li>
<li>
<p><code>\dv</code> - List views</p>
</li>
<li>
<p><code>\e</code> - Open default text editor in psql shell</p>
</li>
<li>
<p><code>\copy (SELECT * FROM __table_name__) TO 'file_path_and_name.csv' WITH CSV</code> - Export a table as CSV</p>
</li>
</ul>
<h4 id="settings">Settings</h4>
<ul>
<li><code>\timing</code> - Turn on query timing</li>
<li><code>\x</code> - Pretty-format query results</li>
</ul>
<h2 id="backup-and-restore">Backup and Restore</h2>
<h4 id="backup-plain-text">Backup, plain text</h4>
<ul>
<li><code>pg_dump &lt;dbname&gt; &gt; db.sql</code> - plain text</li>
</ul>
<h4 id="backup-for-persistence-and-storage">Backup, for persistence and storage</h4>
<ul>
<li><code>pg_dump -Fc &lt;dbname&gt; &gt; db.bak</code> - compressed binary format</li>
<li><code>pg_dump -Ft &lt;dbname&gt; &gt; db.tar</code> - tarball format</li>
</ul>
<h4 id="restore">Restore</h4>
<p>If the database already exists,</p>
<ul>
<li><code>pg_restore -Fc db.bak</code> - restore compressed binary format</li>
<li><code>pg_restore -Ft db.tar</code> - restore tarball format</li>
</ul>
<p>If creating the database new from a dump, you&rsquo;ll need to add the <code>-C</code> flag.</p>
<h4 id="import-as-a-new-database">Import, as a new database</h4>
<p>Create the database</p>
<ul>
<li><code>createdb -T template0 &lt;dbname&gt;</code></li>
</ul>
<p>Import database from dump</p>
<ul>
<li><code>pg_restore --clean --no-owner --verbose -d &lt;dbname&gt; db.bak</code> -</li>
</ul>
<h2 id="database-commands-outside-of-psql">Database Commands, outside of psql</h2>
<ul>
<li>Create database <code>createdb &lt;database_name&gt;</code></li>
<li>Drop database <code>dropdb &lt;database_name&gt;</code></li>
<li>Restore database <code>pg_restore --no-owner --dbname &lt;database&gt; &lt;database.dump&gt;</code></li>
</ul>
<h2 id="database-commands-inside-of-psql-dont-forget-">Database Commands, inside of PSQL (DON&rsquo;T FORGET <code>;</code>)</h2>
<ul>
<li>Create database <code>CREATE DATABASE &lt;database&gt;</code></li>
<li>Remove database <code>DROP DATABASE &lt;database&gt;</code></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4d001ac0694ab5a6134c85705ed758b8">25 - Python4Lib</h1>
    <div class="lead">Useful Python libraries for working with library data and services</div>
	<h2 id="records">Records</h2>
<ul>
<li><a href="https://github.com/kennethreitz/records">https://github.com/kennethreitz/records</a></li>
<li>Okay if you just want some tabular data in a single sheet</li>
</ul>
<h2 id="openpyxl">OpenPyxl</h2>
<ul>
<li><a href="https://openpyxl.readthedocs.io/en/stable/">https://openpyxl.readthedocs.io/en/stable/</a></li>
<li>Manipulating xls, xlsx files</li>
</ul>
<h2 id="xmltodict">XMLtoDict</h2>
<ul>
<li><a href="https://github.com/martinblech/xmltodict">https://github.com/martinblech/xmltodict</a></li>
</ul>
<h2 id="paramiko">Paramiko</h2>
<ul>
<li><a href="http://docs.paramiko.org/en/2.4/api/sftp.html">http://docs.paramiko.org/en/2.4/api/sftp.html</a></li>
</ul>
<h2 id="ftputil">ftputil</h2>
<ul>
<li><a href="https://pypi.org/project/ftputil/">https://pypi.org/project/ftputil/</a></li>
</ul>
<h2 id="pymarc">PyMarc</h2>
<ul>
<li><a href="https://github.com/edsu/pymarc">https://github.com/edsu/pymarc</a></li>
</ul>
<h2 id="pybibframe">pybibframe</h2>
<ul>
<li><a href="https://pypi.org/project/pybibframe/">https://pypi.org/project/pybibframe/</a></li>
</ul>
<h2 id="csv">CSV</h2>
<ul>
<li><a href="https://docs.python.org/3/library/csv.html">https://docs.python.org/3/library/csv.html</a></li>
</ul>
<h2 id="built-in-json">Built in JSON</h2>
<ul>
<li><a href="https://docs.python.org/3/library/json.html">https://docs.python.org/3/library/json.html</a></li>
<li><a href="https://realpython.com/python-json/">Working With JSON Data in Python</a></li>
</ul>
<h2 id="pyyaml">PyYAML</h2>
<ul>
<li><a href="https://pyyaml.org/wiki/PyYAMLDocumentation">https://pyyaml.org/wiki/PyYAMLDocumentation</a></li>
</ul>
<h2 id="psycops2">Psycops2</h2>
<ul>
<li><a href="https://pypi.org/project/psycopg2/">https://pypi.org/project/psycopg2/</a></li>
<li>PostgreSQL adaptor</li>
</ul>
<h2 id="shutil">Shutil</h2>
<ul>
<li><a href="https://docs.python.org/3/library/shutil.html">https://docs.python.org/3/library/shutil.html</a></li>
<li>Shell util</li>
</ul>
<h1 id="fuzzy-wuzzy">Fuzzy Wuzzy</h1>
<ul>
<li><a href="https://github.com/seatgeek/fuzzywuzzy">https://github.com/seatgeek/fuzzywuzzy</a></li>
</ul>
<h1 id="pikepff">pikepff</h1>
<ul>
<li><a href="https://github.com/pikepdf/pikepdf">https://github.com/pikepdf/pikepdf</a></li>
</ul>
<h1 id="csvkit">csvkit</h1>
<ul>
<li><a href="https://github.com/wireservice/csvkit">https://github.com/wireservice/csvkit</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-deab9c3f5809ad887498368c25842ebc">26 - React.js</h1>
    <div class="lead">React - JavaScript Library</div>
	<p>Some initial notes during the exploration of <a href="https://reactjs.org/">React.js</a> JavaScript library.</p>
<h2 id="draft">Draft</h2>
<p>Everything on this page is in draft-mode. Expect errors, amendments, oversights, and corrections.</p>
<h3 id="quick-start">Quick Start</h3>
<ul>
<li>Facebook&rsquo;s <a href="https://github.com/facebook/create-react-app">create-react-app</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript">MDN web docs - JavaScript</a></li>
<li>Compatibility checks with browser via <a href="https://babeljs.io/">Babel</a></li>
<li>Reusable components! <a href="https://github.com/teambit/bit">bit</a></li>
</ul>
<h3 id="contentdm-documentation">CONTENTdm Documentation</h3>
<p>CONTENTdm provides <a href="https://help.oclc.org/Metadata_Services/CONTENTdm/Advanced_website_customization/JavaScript_customizations">JavaScript Customization Docs</a> to facilitate a general understanding of the React-based CONTENTdm application.</p>
<h4 id="css-classeshttpshelpoclcorgmetadata_servicescontentdmadvanced_website_customizationcss_customizationscss_page_classes"><a href="https://help.oclc.org/Metadata_Services/CONTENTdm/Advanced_website_customization/CSS_customizations/CSS_page_classes">CSS Classes</a></h4>
<p>CSS Classes are broken down into the following classifications:</p>
<blockquote>
<p>Website-level classes
Component-level classes
Page: Global classes
Page: Collection-level classes</p>
</blockquote>
<h4 id="javascript-eventshttpshelpoclcorgmetadata_servicescontentdmadvanced_website_customizationjavascript_customizationsjavascript_events"><a href="https://help.oclc.org/Metadata_Services/CONTENTdm/Advanced_website_customization/JavaScript_customizations/JavaScript_events">JavaScript Events</a></h4>
<p>A special event fires at the initial load of the application: <code>cdm-app:ready</code>. This event fires once for a given end-user session and is the earliest time point in the application lifecycle.</p>
<blockquote>
<p>:enter<br>
:ready<br>
:update<br>
:leave</p>
</blockquote>
<p>In CONTENTdm, <strong>if the URL does not change</strong>, then the end user action is most likely happening simultaneously with an <code>:update</code> event.</p>
<h4 id="list-of-lifecycle-eventshttpshelpoclcorgmetadata_servicescontentdmadvanced_website_customizationjavascript_customizationslist_of_javascript_lifecycle_events"><a href="https://help.oclc.org/Metadata_Services/CONTENTdm/Advanced_website_customization/JavaScript_customizations/List_of_JavaScript_lifecycle_events">List of Lifecycle Events</a></h4>
<p>The CONTENTdm application provides a CustomEvent() object within the lifecycle of the application and page render</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>document.addEventListener<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#4e9a06">&#39;cdm-home-page:enter&#39;</span>, <span style="color:#204a87;font-weight:bold">function</span><span style="color:#ce5c00;font-weight:bold">(</span>e<span style="color:#ce5c00;font-weight:bold">){</span>
</span></span><span style="display:flex;"><span>    // e is instance of CustomEvent
</span></span><span style="display:flex;"><span>    // ...
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">})</span><span style="color:#000;font-weight:bold">;</span>
</span></span></code></pre></div><h4 id="customization-cookbookhttpshelpoclcorgmetadata_servicescontentdmadvanced_website_customizationcustomization_cookbook"><a href="https://help.oclc.org/Metadata_Services/CONTENTdm/Advanced_website_customization/Customization_cookbook">Customization Cookbook</a></h4>
<p>There&rsquo;s also a <a href="https://cdmdemo.contentdm.oclc.org/digital/custom/recipedownloads">Recipe Portal</a> with downloadable code and demonstration sites.</p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-8a51d7972e5f4f1e0f8eecb27948bd81">27 - Samba</h1>
    <div class="lead">Basic setup using samba on a Raspberry Pi 4 for time machine backups</div>
	<h3 id="step-1">STEP 1</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">## --------------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">## Set up Storage Block Disk</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">## --------------------------</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># list block devices</span>
</span></span><span style="display:flex;"><span>lsblk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Delete partitions and reboot</span>
</span></span><span style="display:flex;"><span>sfdisk --delete /dev/sda
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Write Files system</span>
</span></span><span style="display:flex;"><span>mkfs.ext4 -j -L SambaStorage /dev/sda
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># List block ids</span>
</span></span><span style="display:flex;"><span>blkid
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># update file system table</span>
</span></span><span style="display:flex;"><span>vim /etc/fstab
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># mount all volumes in fs table</span>
</span></span><span style="display:flex;"><span>mount -a
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># reboot</span>
</span></span><span style="display:flex;"><span>reboot
</span></span></code></pre></div><h3 id="step-2">STEP 2</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">## -------------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">## Install Samba</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">## -------------------------</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Install Samba</span>
</span></span><span style="display:flex;"><span>apt-get install samba
</span></span></code></pre></div><h3 id="step-3">STEP 3</h3>
<p>Update Samba Configuration to listen only to local network
<code>/etc/samba/smb.conf</code>. The following are snippets, not a complete samba
configuration file.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>global<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#### macOS definitions #####</span>
</span></span><span style="display:flex;"><span>min <span style="color:#000">protocol</span> <span style="color:#ce5c00;font-weight:bold">=</span> SMB2
</span></span><span style="display:flex;"><span><span style="color:#000">spotlight</span> <span style="color:#ce5c00;font-weight:bold">=</span> yes
</span></span><span style="display:flex;"><span>fruit:metadata <span style="color:#ce5c00;font-weight:bold">=</span> stream
</span></span><span style="display:flex;"><span>fruit:model <span style="color:#ce5c00;font-weight:bold">=</span> MacSamba
</span></span><span style="display:flex;"><span>fruit:posix_rename <span style="color:#ce5c00;font-weight:bold">=</span> yes
</span></span><span style="display:flex;"><span>fruit:delete_empty_adfiles <span style="color:#ce5c00;font-weight:bold">=</span> yes
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># SAMBA USER ACCOUNTS</span>
</span></span><span style="display:flex;"><span><span style="color:#ce5c00;font-weight:bold">[</span>derek<span style="color:#ce5c00;font-weight:bold">]</span>
</span></span><span style="display:flex;"><span>    <span style="color:#000">path</span> <span style="color:#ce5c00;font-weight:bold">=</span> /samba/users/derek
</span></span><span style="display:flex;"><span>    <span style="color:#000">browseable</span> <span style="color:#ce5c00;font-weight:bold">=</span> yes
</span></span><span style="display:flex;"><span>    <span style="color:#000">writeable</span> <span style="color:#ce5c00;font-weight:bold">=</span> yes
</span></span><span style="display:flex;"><span>    <span style="color:#204a87">read</span> <span style="color:#000">only</span> <span style="color:#ce5c00;font-weight:bold">=</span> no
</span></span><span style="display:flex;"><span>    fruit:aapl <span style="color:#ce5c00;font-weight:bold">=</span> yes
</span></span><span style="display:flex;"><span>    fruit:time <span style="color:#000">machine</span> <span style="color:#ce5c00;font-weight:bold">=</span> yes
</span></span><span style="display:flex;"><span>    vfs <span style="color:#000">objects</span> <span style="color:#ce5c00;font-weight:bold">=</span> catia fruit streams_xattr
</span></span><span style="display:flex;"><span>    force create <span style="color:#000">mode</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">0660</span>
</span></span><span style="display:flex;"><span>    force directory <span style="color:#000">mode</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#0000cf;font-weight:bold">2770</span>
</span></span><span style="display:flex;"><span>    valid <span style="color:#000">users</span> <span style="color:#ce5c00;font-weight:bold">=</span> derek
</span></span></code></pre></div><h3 id="step-4">STEP 4</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Test Config after Changes</span>
</span></span><span style="display:flex;"><span>testparm
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Restart services</span>
</span></span><span style="display:flex;"><span>systemctl restart smbd
</span></span><span style="display:flex;"><span>systemctl restart nmbd
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">## -----------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">## Create users</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">## -----------------------</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>useradd -M -d /samba/users/derek -s /usr/sbin/nologin -G sambashare derek
</span></span><span style="display:flex;"><span>mkdir /samba/users/derek
</span></span><span style="display:flex;"><span>chown derek:sambashare /samba/users/derek
</span></span><span style="display:flex;"><span>chmod <span style="color:#0000cf;font-weight:bold">2770</span> /samba/users/derek
</span></span><span style="display:flex;"><span>smbpasswd -a derek
</span></span><span style="display:flex;"><span>smbpasswd -e derek
</span></span></code></pre></div><h3 id="step-5">STEP 5</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">## ------------------------</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">## Connect from macOS</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">## ------------------------</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Connecting from macOS on local network static IP</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># LAN DNS via PiHole</span>
</span></span><span style="display:flex;"><span>smb://backup.derekzoladz.com/derek
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-97ba8b7270d986b9bc05453c9816bf53">28 - sed &amp; awk</h1>
    <div class="lead">Practical applications for sed &amp; awk in library environments</div>
	<h2 id="sed-stream-editor">sed (stream editor)</h2>
<p><strong>To perform an operation, use <code>sed -i</code>; otherwise, <code>sed</code> performs a dry-run.</strong></p>
<p>You got 60+ logrotate configuration files in <code>/etc/logrotate.d</code> and you need to add the <code>delaycompress</code> directive, after the <code>compress</code> directive, to each of the files. The name of each configuration file that needs to be updated begins with <code>ezproxy_</code>. No problem!</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sed <span style="color:#4e9a06">&#39;/compress/a\    delaycompress&#39;</span> ezproxy_*
</span></span></code></pre></div><p>You&rsquo;ve got 60+ Let&rsquo;s Encrypt certificate <code>.conf</code> files that you need to increase
the delay for propogation of the DNS TXT file challenge. In the example below,
if a line in the configuration file contains <code>dns_google_propagation_seconds</code>,
find the value <code>60</code> and replace it with the value <code>90</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sed <span style="color:#4e9a06">&#39;/dns_google_propagation_seconds/s/60/90/&#39;</span> *.conf
</span></span></code></pre></div><p>You need to add a temporary set of limited administrative credentials to all of
your <code>user.txt</code> files and you want to the new code after either <code>::limit=2</code> or
<code>::Limit=2</code>.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>find . -iname user.txt -exec sed <span style="color:#4e9a06">&#39;/::[lL]imit=2/a ::group=+Admin.StatusUpdate+Admin.Restart \
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">username:password \
</span></span></span><span style="display:flex;"><span><span style="color:#4e9a06">::group=-Admin.StatusUpdate-Admin.Restart&#39;</span> <span style="color:#ce5c00;font-weight:bold">{}</span> <span style="color:#4e9a06">\;</span><span style="color:#000;font-weight:bold">|</span> less
</span></span></code></pre></div><p>Or, when a vendor transitions to HTTPS and you need to update 60+ EZproxy stanzas to specifically allow a new protocol.</p>
<h4 id="here-are-a-few-one-liners">Here are a few one-liners:</h4>
<pre tabindex="0"><code># Print All Matching Lines
sed -n &#39;/^IncludeFile.*/p&#39; config.txt

# Print the First Occurrence of Matching Line
sed -n &#39;/^IncludeFile.*/ {p;q}&#39; config.txt

# Print Last Occurrence of a Match
tac config.txt | sed -n &#39;/^IncludeFile.*/ {p;q}&#39;
</code></pre><h2 id="awk-columnar-data-processor">awk (columnar data processor)</h2>
<p>Read through a directory of log files, find entries for a specific user, sort the results, print only the &ldquo;interesting&rdquo; data points</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>grep -rni <span style="color:#4e9a06">&#34;username&#34;</span> <span style="color:#000;font-weight:bold">|</span> sort <span style="color:#000;font-weight:bold">|</span> awk <span style="color:#4e9a06">&#39;BEGIN {OFS=&#34;\t&#34;}; {split($1,date,&#34;:&#34;); print date[3], $2, $3, $4}&#39;</span>
</span></span></code></pre></div><p>You can also find IPs that hit the proxy server most frequently</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>awk <span style="color:#4e9a06">&#39;{ print $4}&#39;</span> <span style="color:#000">$PATH_TO_LOGFILE</span> <span style="color:#000;font-weight:bold">|</span> sort <span style="color:#000;font-weight:bold">|</span> uniq -c <span style="color:#000;font-weight:bold">|</span> sort -nr <span style="color:#000;font-weight:bold">|</span> head -n <span style="color:#0000cf;font-weight:bold">20</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-a35b90e7084d279f74ffcbdc5fac0a1f">29 - SIP2</h1>
    
	<hr>
<ul>
<li><a href="https://www.niso.org/standards-committees/sip">NISO SIP</a></li>
<li><a href="http://multimedia.3m.com/mws/media/355361O/sip2-protocol.pdf">3M SIP2 Protocol</a></li>
<li><a href="https://github.com/berick/pysip2">pysip2-client</a></li>
</ul>
<h5 id="connect">Connect</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>telnet cool-cat.org <span style="color:#0000cf;font-weight:bold">6001</span>
</span></span></code></pre></div><h5 id="format-to-pass-credentials">Format to pass credentials</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>9300CN&lt;username&gt;<span style="color:#000;font-weight:bold">|</span>CO&lt;password&gt;<span style="color:#000;font-weight:bold">|</span>CP&lt;institutionid&gt;
</span></span><span style="display:flex;"><span>9300CNdz1<span style="color:#000;font-weight:bold">|</span>CO&lt;password&gt;<span style="color:#000;font-weight:bold">|</span>CPCOOL
</span></span></code></pre></div><p><em>connection responses</em></p>
<ul>
<li>941 # success</li>
<li>940 # failed</li>
</ul>
<h5 id="patron-information-request">Patron information request</h5>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#0000cf;font-weight:bold">6300320170218</span>          <span style="color:#0000cf;font-weight:bold">201700</span>    AO&lt;institutionid&gt;<span style="color:#000;font-weight:bold">|</span>AA&lt;patronbarcode&gt;
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-4afcd525437783c4871fc01163c00b1d">30 - SSH</h1>
    <div class="lead">SSH quick start</div>
	<ol>
<li>Generate Keys <a href="https://ed25519.cr.yp.to/software.html">ed25519</a></li>
</ol>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh-keygen -t ed25519
</span></span></code></pre></div><ol start="2">
<li>Use an SSH config file: <code>~/.ssh/config</code></li>
</ol>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-fa3c0e256e14bb859b3cc5b5639d1bfb">31 - SSL</h1>
    <div class="lead">Common SSL tasks and terminology</div>
	<p>The private key used to generate a CSR needs to match the private .key file placed on the server to match the .crt file.</p>
<h4 id="x509-file-extensions">X509 File Extensions</h4>
<table>
<thead>
<tr>
<th style="text-align:center">Extension</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">.der</td>
<td>Binary DER encoded certificates. These files may also bear the CER or the CRT extension.</td>
</tr>
<tr>
<td style="text-align:center">.pem</td>
<td>Extension is used for different types of X.509v3 files which contain ASCII (Base64) armored data prefixed with a “—– BEGIN …” line.</td>
</tr>
<tr>
<td style="text-align:center">.crt</td>
<td>Used for certificates. The certificates may be encoded as binary DER or as ASCII PEM. The CER and CRT extensions are nearly synonymous.</td>
</tr>
<tr>
<td style="text-align:center">.cer</td>
<td>Alternate form of .crt (Microsoft Convention)</td>
</tr>
<tr>
<td style="text-align:center">.key</td>
<td>Used both for public and private keys. The keys may be encoded as binary DER or as ASCII PEM.</td>
</tr>
</tbody>
</table>
<p>Generate the necessary files</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># generate the private RSA key</span>
</span></span><span style="display:flex;"><span>openssl genrsa -out some-domain-private.key <span style="color:#0000cf;font-weight:bold">2048</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Generating the CSR</span>
</span></span><span style="display:flex;"><span>openssl req -new -key /path/to/some-domain-private.key -out /path/to/some-domain.csr
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Generate .p12 bundle, PKCS #12</span>
</span></span><span style="display:flex;"><span>openssl pkcs12 -export -out some-domain.p12 -inkey some-domain-privatekey.pem -in some-domain-cert.pem -certfile some-domain-intermediatecert.pem
</span></span></code></pre></div><p>PEM encoded certificates are not human readable.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openssl x509 -in some-domain.pem -text -noout
</span></span><span style="display:flex;"><span>openssl x509 -in some-domain.cer -text -noout
</span></span><span style="display:flex;"><span>openssl x509 -in some-domain.crt -text -noout
</span></span></code></pre></div><p>Viewing .der certificates</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openssl x509 -in some-domain.der -inform der -text -noout
</span></span></code></pre></div><p>Viewing .csr information</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openssl req -text -noout -verify -in filename.csr
</span></span></code></pre></div><p>Check if a private key matches a certificate. If the results of the following commands match, the private key is a match to the certificate.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>openssl x509 -noout -modulus -in some-domain.crt <span style="color:#000;font-weight:bold">|</span> openssl md5 
</span></span><span style="display:flex;"><span>openssl rsa -noout -modulus -in some-domain.key <span style="color:#000;font-weight:bold">|</span> openssl md5
</span></span></code></pre></div><h4 id="general">General</h4>
<ul>
<li>Check Available Entropy (0 - 4096): <code>cat /proc/sys/kernel/random/entropy_avail</code></li>
<li>Watch Available Entropy: <code>watch -n .1 cat /proc/sys/kernel/random/entropy_avail</code></li>
</ul>
<p>Supporting low entropy states with the HAVEGE algorithm</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Ubuntu, install haveged package</span>
</span></span><span style="display:flex;"><span>apt-get install haveged
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Tuning - /etc/default/haveged</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># -w sets low entropy watermark (in bits)</span>
</span></span><span style="display:flex;"><span><span style="color:#000">DAEMON_ARGS</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#4e9a06">&#34;-w 2048&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Start Service at reboot</span>
</span></span><span style="display:flex;"><span>update-rc.d haveged defaults <span style="color:#0000cf;font-weight:bold">00</span> <span style="color:#0000cf;font-weight:bold">99</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># test system entropy</span>
</span></span><span style="display:flex;"><span>apt-get install rng-tools
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Run FIPS-140 tests</span>
</span></span><span style="display:flex;"><span>cat /dev/random <span style="color:#000;font-weight:bold">|</span> rngtest -c <span style="color:#0000cf;font-weight:bold">1000</span>
</span></span></code></pre></div><p>Ask the <code>urandom</code> device to spit out 1k of gooey randomness</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>head -c 1k /dev/urandom <span style="color:#000;font-weight:bold">|</span> tr -dc <span style="color:#4e9a06">&#39;a-zA-Z0-9!@#$%^&amp;&#39;</span> <span style="color:#000;font-weight:bold">|</span> fold -w <span style="color:#0000cf;font-weight:bold">100</span> <span style="color:#ce5c00;font-weight:bold">&amp;&amp;</span> <span style="color:#204a87">printf</span>  <span style="color:#4e9a06">&#34;\n&#34;</span>
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-e64f462522bc621294722a4446c22a9f">32 - SysAdmin Tasks</h1>
    <div class="lead">A collection commands for tasks that I&rsquo;ve needed to perform multiple times.</div>
	<h2 id="convert-putty-ssh2-public-key-to-openssh">Convert PuTTY SSH2 Public Key to OpenSSH</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ssh-keygen -if ssh2publickey.pub &gt;&gt; opensshpublickey.pub
</span></span></code></pre></div><h2 id="identify-responding-server">Identify Responding Server</h2>
<pre tabindex="0"><code>curl -s -I sts.psychiatrist.com|sed -n &#39;s/^S[erv]*: //p&#39;
</code></pre><h2 id="byte-order-mark-bom">Byte Order Mark (BOM)</h2>
<p>When EZproxy configuration files are edited in Microsoft NotePad, EZproxy will complain - upon restart - about the single byte character <code>ï»¿</code> that begins the <code>config.txt</code> file. EZproxy expects UTF-8 encoding that does not start with a non-ASCII byte, like a BOM.</p>
<p>Using vim, does current file have a BOM?</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>:set bomb?
</span></span></code></pre></div><p>Remove BOM and write file back to disk:</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>:set nobomb
</span></span></code></pre></div><h2 id="print-the-number-of-lines-in-a-file">Print the Number of Lines in a File</h2>
<p>Because I can never remember the command I need</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wc -l &lt;file&gt;
</span></span></code></pre></div><h2 id="delete-old-kernels-classic-version">Delete Old Kernels, Classic Version</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>uname -r <span style="color:#8f5902;font-style:italic"># the kernel in use</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>dpkg -l <span style="color:#000;font-weight:bold">|</span> grep linux-image <span style="color:#000;font-weight:bold">|</span> awk <span style="color:#4e9a06">&#39;{print$2}&#39;</span>
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>apt remove --purge linux-image-3.1.0-131-generic
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>update-grub
</span></span></code></pre></div><h2 id="convert-mov---mp4-with-ffmpeg">Convert .mov -&gt; .mp4 With FFMPEG</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>ffmpeg -i Untitled.mov -vcodec h264 -acodec mp2 Untitled.mp4
</span></span></code></pre></div><h2 id="convert-pdf---jpg-with-imagemagick">Convert .pdf -&gt; .jpg with ImageMagick</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># %d will iterate using 1 digit, %3d 3 digits</span>
</span></span><span style="display:flex;"><span>convert -density <span style="color:#0000cf;font-weight:bold">150</span> art.pdf -quality <span style="color:#0000cf;font-weight:bold">90</span> %d.jpg
</span></span></code></pre></div><h2 id="find-the-size-of-a-directory">Find the Size of a Directory</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>du -hs /path/to/directory
</span></span></code></pre></div><h2 id="locate-all-files-with-a-specific-name-in-the-entire-directory-and-search-through-those-files-for-a-line-of-text-using-regex-sort">Locate all files with a specific name in the entire directory and search through those files for a line of text using regex, sort</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>find . -iname config.txt -exec grep <span style="color:#4e9a06">&#34;^[A-Za-z ]*\.ohionet\.org&#34;</span> <span style="color:#ce5c00;font-weight:bold">{}</span> <span style="color:#4e9a06">\;</span> -print <span style="color:#000;font-weight:bold">|</span> grep Name <span style="color:#000;font-weight:bold">|</span> sort
</span></span></code></pre></div><h2 id="imagemagick-convert-to-progressive-jpeg">Imagemagick, Convert to Progressive JPEG</h2>
<h4 id="entire-directory">entire directory</h4>
<p><code>mogrify -interlace plane *.jpg</code></p>
<h4 id="single-file">single file</h4>
<p><code>convert inputfile.jpg -interlace plane outputfile.jpg</code></p>
<h4 id="progressive-jpeg-will-state-interlace-jpeg">Progressive JPEG will state, Interlace: JPEG</h4>
<p><code>identify -verbose file.jpg</code></p>
<h2 id="globbing">Globbing</h2>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Minutes flag</span>
</span></span><span style="display:flex;"><span>-mmin +360
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Days flag</span>
</span></span><span style="display:flex;"><span>-mtime +7
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Include only files with an extension of &#39;txt&#39;</span>
</span></span><span style="display:flex;"><span>find /sftp/plc/incoming/ -type f -name <span style="color:#4e9a06">&#39;*.txt&#39;</span> -print0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Exclude any directories with a name that start with &#39;pl&#39;. Include only files older than 30 hours.</span>
</span></span><span style="display:flex;"><span>find /sftp/<span style="color:#ce5c00;font-weight:bold">[</span>^pl<span style="color:#ce5c00;font-weight:bold">]</span>*/incoming/ -type f -mmin +1800  -print0
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Include directories with a specific name. Remove all matching files that are older than 30 hours.</span>
</span></span><span style="display:flex;"><span>find /sftp/<span style="color:#ce5c00;font-weight:bold">[</span><span style="color:#4e9a06">\(</span>antioch<span style="color:#4e9a06">\|</span>findlay<span style="color:#4e9a06">\|</span>franciscan<span style="color:#4e9a06">\|</span>wilmington<span style="color:#4e9a06">\)</span><span style="color:#ce5c00;font-weight:bold">]</span>*/incoming/ -type f -mmin +1800  -print0 <span style="color:#000;font-weight:bold">|</span> xargs -r0 rm --
</span></span></code></pre></div><h2 id="tuning-with-sysctl">Tuning with Sysctl</h2>
<p>File Location on Ubuntu</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>nano -w /etc/sysctl.conf
</span></span></code></pre></div><p>Count instances of SYN received</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>netstat -ant<span style="color:#000;font-weight:bold">|</span>grep SYN_RECV<span style="color:#000;font-weight:bold">|</span>wc -l
</span></span></code></pre></div><p>Check States</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>netstat -nta <span style="color:#000;font-weight:bold">|</span> egrep <span style="color:#4e9a06">&#34;State|443&#34;</span>
</span></span><span style="display:flex;"><span>netstat -nta <span style="color:#000;font-weight:bold">|</span> egrep <span style="color:#4e9a06">&#34;State|80&#34;</span>
</span></span></code></pre></div><p>Check Current Value for Parameter</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sysctl -n net.ipv4.tcp_syncookies
</span></span><span style="display:flex;"><span>sysctl -n net.ipv4.tcp_max_syn_backlog
</span></span><span style="display:flex;"><span>sysctl -n net.ipv4.tcp_synack_retries
</span></span><span style="display:flex;"><span>sysctl -n net.core.somaxconn
</span></span></code></pre></div><p>Reload configuration</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>sysctl -p
</span></span></code></pre></div><h2 id="batch-updating-files-on-the-server">Batch Updating Files on the Server</h2>
<h4 id="find-files-owned-by-a-user">Find files owned by a user</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#find {path} -user {username}</span>
</span></span><span style="display:flex;"><span>find /usr/local -user derek
</span></span></code></pre></div><h4 id="find-files-assigned-to-a-group">Find files assigned to a group</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>find <span style="color:#ce5c00;font-weight:bold">{</span>path<span style="color:#ce5c00;font-weight:bold">}</span> -group <span style="color:#ce5c00;font-weight:bold">{</span>username<span style="color:#ce5c00;font-weight:bold">}</span>
</span></span><span style="display:flex;"><span>find /usr/local -group derek
</span></span></code></pre></div><h4 id="change-ownership-or-group">Change Ownership or Group</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic">#chown --from=olduser newuser * -R</span>
</span></span><span style="display:flex;"><span>chown --from<span style="color:#ce5c00;font-weight:bold">=</span>david derek * -R
</span></span><span style="display:flex;"><span>chown --from<span style="color:#ce5c00;font-weight:bold">=</span>:1053 :derek * -R
</span></span></code></pre></div><h4 id="show-me-the-redirects">Show Me the Redirects!</h4>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>wget http://libguides.heidelberg.edu/asc 2&gt;<span style="color:#000;font-weight:bold">&amp;</span><span style="color:#0000cf;font-weight:bold">1</span> <span style="color:#000;font-weight:bold">|</span> grep Location:
</span></span></code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-330296a33da2967fa7e490b7318daf81">33 - Yaz</h1>
    <div class="lead">Client to interface with z39.50 servers</div>
	<p>Install Homebrew</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>/usr/bin/ruby -e <span style="color:#4e9a06">&#34;</span><span style="color:#204a87;font-weight:bold">$(</span>curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install<span style="color:#204a87;font-weight:bold">)</span><span style="color:#4e9a06">&#34;</span>
</span></span></code></pre></div><p>Install Yaz</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span>brew install yaz
</span></span></code></pre></div><p>Read the <a href="http://www.indexdata.com/yaz/doc/">YAZ Docs</a>, <a href="http://irspy.indexdata.com/">find a z39.50 target</a>, review <a href="https://www.loc.gov/z3950/agency/defns/bib1.html">bib-1 attribute set</a>, and give it a whirl.</p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># start Yaz connection to Library of Congress z39.50</span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># z39.50 server is running on port 7090, via voyager</span>
</span></span><span style="display:flex;"><span>yaz-client z3950.loc.gov:7090/voyager
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># open the connection for searching</span>
</span></span><span style="display:flex;"><span>open z3950.loc.gov:7090/voyager
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Send a boolean query</span>
</span></span><span style="display:flex;"><span>find @and cats hot
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Use Bib-1 Attributes (find &#34;&#34; in 245)</span>
</span></span><span style="display:flex;"><span>find @attr <span style="color:#000">1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">4</span> <span style="color:#4e9a06">&#34;rocco di pietro&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Use Bib-1 Attributes to search ISBN</span>
</span></span><span style="display:flex;"><span>find @attr <span style="color:#000">1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">7</span> <span style="color:#4e9a06">&#34;9780674015432&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Return one record</span>
</span></span><span style="display:flex;"><span>s <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Change record format</span>
</span></span><span style="display:flex;"><span>format xml
</span></span><span style="display:flex;"><span>format marc21
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Display client settings</span>
</span></span><span style="display:flex;"><span>list_all
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># capture records in file</span>
</span></span><span style="display:flex;"><span>set_marcdump /Users/Derek/Desktop/download.mrc
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># find available commands and options</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">help</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># close the connection</span>
</span></span><span style="display:flex;"><span>close
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Exit the client</span>
</span></span><span style="display:flex;"><span><span style="color:#204a87">exit</span>
</span></span></code></pre></div><h3 id="innovative-interfaces-sierra">Innovative Interfaces, Sierra</h3>
<p>The standard z39.50 port is <em>210</em></p>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Yaz connection to State Library of Ohio z39.50</span>
</span></span><span style="display:flex;"><span>yaz-client catalog.library.ohio.gov:210/innopac
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Open connection for search</span>
</span></span><span style="display:flex;"><span>open catalog.library.ohio.gov:210/innopac
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Grab a specific bibliographic record</span>
</span></span><span style="display:flex;"><span>find @attr <span style="color:#000">1</span><span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#0000cf;font-weight:bold">12</span> <span style="color:#4e9a06">&#34;b2769533&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Show the MARC</span>
</span></span><span style="display:flex;"><span>s <span style="color:#0000cf;font-weight:bold">1</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Change the output format to OPAC for additional info</span>
</span></span><span style="display:flex;"><span>format opac
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>&gt; Data holdings <span style="color:#0000cf;font-weight:bold">0</span>
</span></span><span style="display:flex;"><span>&gt; localLocation: Stacks
</span></span><span style="display:flex;"><span>&gt; callNumber: RA790 .M613 <span style="color:#0000cf;font-weight:bold">2018</span>
</span></span><span style="display:flex;"><span>&gt; publicNote: AVAILABLE
</span></span></code></pre></div><h3 id="evergreen-ils">Evergreen ILS</h3>
<div class="highlight"><pre tabindex="0" style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-bash" data-lang="bash"><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Yaz Connection</span>
</span></span><span style="display:flex;"><span>yaz-client galion.cool-cat.org:210
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Open Galion database</span>
</span></span><span style="display:flex;"><span>open galion.cool-cat.org:210/galion
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Find some cats</span>
</span></span><span style="display:flex;"><span>find cats
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#8f5902;font-style:italic"># Return cat at index 1</span>
</span></span><span style="display:flex;"><span>show <span style="color:#0000cf;font-weight:bold">1</span>
</span></span></code></pre></div>
</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Email" aria-label="Email">
    <a class="text-white" target="_blank" rel="noopener" href="mailto:derek@derekzoladz.com" aria-label="Email">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener" href="https://example.org/derek_zoladz" aria-label="Twitter">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener" href="https://github.com/dzoladz" aria-label="GitHub">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Website" aria-label="Website">
    <a class="text-white" target="_blank" rel="noopener" href="https://www.derekzoladz.com/" aria-label="Website">
      <i class="fas fa-globe-americas"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2022 Derek Zoladz All Rights Reserved</small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    <script src="/palimpsest/js/main.min.6227ad7036f289989c8d2be757b53e3a42aedf74e0b3837489c15e442ee0d71b.js" integrity="sha256-YietcDbyiZicjSvnV7U&#43;OkKu33Tgs4N0icFeRC7g1xs=" crossorigin="anonymous"></script>
<script src='/palimpsest/js/tabpane-persist.js'></script>

  </body>
</html>
