<!doctype html>
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="generator" content="Hugo 0.82.0" /><link rel="canonical" type="text/html" href="/palimpsest/docs/laboratory/">
<META NAME="ROBOTS" CONTENT="NOINDEX, NOFOLLOW">


<link rel="shortcut icon" href="/palimpsest/favicons/favicon.ico" >
<link rel="apple-touch-icon" href="/palimpsest/favicons/apple-touch-icon-180x180.png" sizes="180x180">
<link rel="icon" type="image/png" href="/palimpsest/favicons/favicon-16x16.png" sizes="16x16">
<link rel="icon" type="image/png" href="/palimpsest/favicons/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/palimpsest/favicons/android-36x36.png" sizes="36x36">
<link rel="icon" type="image/png" href="/palimpsest/favicons/android-48x48.png" sizes="48x48">
<link rel="icon" type="image/png" href="/palimpsest/favicons/android-72x72.png" sizes="72x72">
<link rel="icon" type="image/png" href="/palimpsest/favicons/android-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/palimpsest/favicons/android-144x144.png" sizes="144x144">
<link rel="icon" type="image/png" href="/palimpsest/favicons/android-192x192.png" sizes="192x192">

<title>Laboratory | Derek C. Zoladz</title><meta property="og:title" content="Laboratory" />
<meta property="og:description" content="Laboratory
" />
<meta property="og:type" content="website" />
<meta property="og:url" content="/palimpsest/docs/laboratory/" /><meta property="og:site_name" content="Derek C. Zoladz" />

<meta itemprop="name" content="Laboratory">
<meta itemprop="description" content="Laboratory
"><meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Laboratory"/>
<meta name="twitter:description" content="Laboratory
"/>





<link rel="preload" href="/palimpsest/scss/main.min.2e82df9c6c5761c9c49bbdf1e65619db467a7e439eeba45b37db308b5a2add25.css" as="style">
<link href="/palimpsest/scss/main.min.2e82df9c6c5761c9c49bbdf1e65619db467a7e439eeba45b37db308b5a2add25.css" rel="stylesheet" integrity="">


<script
  src="https://code.jquery.com/jquery-3.5.1.min.js"
  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
  crossorigin="anonymous"></script>





  </head>
  <body class="td-section">
    <header>
      
<nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar">
        <a class="navbar-brand" href="/palimpsest/">
		<span class="navbar-logo"></span>
	</a>
	<div class="td-navbar-nav-scroll ml-md-auto" id="main_navbar">
		<ul class="navbar-nav mt-2 mt-lg-0">
			
			
			<li class="nav-item mr-4 mb-2 mb-lg-0">
				
				
				
				
				<a  class="nav-link" href="/palimpsest" ><span>Home</span></a>
			</li>
			
			
			
		</ul>
	</div>
	<div class="navbar-nav d-none d-lg-block">
</div>
</nav>

    </header>
    <div class="container-fluid td-outer">
      <div class="td-main">
        <div class="row flex-xl-nowrap">
          <div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none">
          </div>
          <div class="d-none d-xl-block col-xl-2 td-toc d-print-none">
          </div>
          <main class="col-12 col-md-9 col-xl-8 pl-md-5" role="main">
            




<div class="td-content">
<div class="pageinfo pageinfo-primary d-print-none">
<p>
This the multi-page printable view of this section.
<a href="#" onclick="print();return false;">Click here to print</a>.
</p><p>
<a href="/palimpsest/docs/laboratory/">Return to the regular view of this page</a>.
</p>
</div>



<h1 class="title">Laboratory</h1>
<div class="lead">Laboratory</div>




    <ul>
    
  
  
  
  

  
    
    
	
<li>1: <a href="#pg-950116f6b0ffb1f8b5808860a1691cea">Kubernetes</a></li>


    
  
    
    
	
<li>2: <a href="#pg-82e44b04aac7309cf87baad80429e4e8">Network Description</a></li>


    
  
    
    
	
<li>3: <a href="#pg-1589b8d2a4885b24db8ab843ed0dccb3">Rancher</a></li>


    
  
    
    
	
<li>4: <a href="#pg-22343580056d27515aa2241b541fb0dc">Raspberry Pi Cluster</a></li>


    
  

    </ul>


<div class="content">
      <p>This is the future location for all of my application hosting experiments at OhioNET that are unusable by the organization. The idea is to build an environment for continued independent learning in technological areas that are focused on developing custom library-adjacent research applications, but are well beyond the capacities of my day job.</p>
<h3 id="cluster-computing---hardware">Cluster Computing - Hardware</h3>
<p><a href="https://theselfhostingblog.com/posts/setting-up-a-kubernetes-cluster-using-raspberry-pis-k3s-and-portainer/#">Raspberry Pi 4, Model B 4GB</a></p>
<h3 id="k3s--rancher">K3s &amp; Rancher</h3>
<p><a href="https://k3s.io/">K3s</a>
<a href="https://rancher.com/products/k3s/">Racnher</a>
<a href="https://helm.sh/">Helm</a></p>
<h3 id="network">Network</h3>
<ul>
<li><input disabled="" type="checkbox"> diagram</li>
<li><input disabled="" type="checkbox"> hardware</li>
</ul>
<h3 id="esmeralda-components">Esmeralda Components</h3>
<p><a href="https://traefik.io/traefik/">Traefik</a>
<a href="https://www.portainer.io/">Portainer</a></p>

</div>
</div>


  
  
  
  

  
  

  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-950116f6b0ffb1f8b5808860a1691cea">1 - Kubernetes</h1>
    <div class="lead">K3s Kubernetes Distribution for ARM Processors</div>
	<p>This is the future location for all of my application hosting experiments at OhioNET that are unusable by the organization. The idea is to build an environment for continued independent learning in technological areas that are focused on developing custom library-adjacent research applications, but are well beyond the capacities of my day job.</p>
<h2 id="3-node-cluster-computing-hardware">3-Node Cluster Computing Hardware</h2>
<h2 id="k3s">K3s</h2>
<p>The lightweight, certified Kubernetes distribution <a href="https://k3s.io/">K3s</a> was selected. The K3s distro is designed from ARM64 architectures like the Raspberry Pi 4.</p>
<h2 id="extended-learning">Extended Learning</h2>
<ul>
<li><a href="https://collabnix.github.io/kubelabs/">An Ultimate Kubernetes Hands-on Labs</a></li>
</ul>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-82e44b04aac7309cf87baad80429e4e8">2 - Network Description</h1>
    <div class="lead">Networking Gear and Diagram</div>
	<h2 id="equipment">Equipment</h2>
<table>
<thead>
<tr>
<th>Device</th>
<th>Manufacturer</th>
<th>Model</th>
</tr>
</thead>
<tbody>
<tr>
<td>Cable Modem, Spectrum</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Router/Firewall</td>
<td>Ubiquiti</td>
<td>UniFi Security Gateway</td>
</tr>
<tr>
<td>UniFi Network Manager</td>
<td>Ubiquiti</td>
<td>UniFi Cloud Key Gen2 Plus</td>
</tr>
<tr>
<td>Switch, S8a</td>
<td>Ubiquiti</td>
<td>8-Port Managed with 802.3af PoE</td>
</tr>
<tr>
<td>Access Point</td>
<td>Ubiquiti</td>
<td>24V 802.3 af/A - AP AC LR</td>
</tr>
<tr>
<td>Backup Disk</td>
<td>NexStar</td>
<td>3.5 SATA 6 Gbps</td>
</tr>
<tr>
<td>Switch, S5a</td>
<td>TPLink</td>
<td>5-Port Unmanaged</td>
</tr>
<tr>
<td>Switch, S5b</td>
<td>TPLink</td>
<td>5-Port Unmanaged</td>
</tr>
<tr>
<td>PiHole</td>
<td>Raspberry Pi Foundation</td>
<td>Pi 3, Model B, 1 GB</td>
</tr>
<tr>
<td>Samba Server</td>
<td>Raspberry Pi Foundation</td>
<td>Pi 4, Model B, 2 GB</td>
</tr>
<tr>
<td>Koha ILS</td>
<td></td>
<td></td>
</tr>
<tr>
<td>Ligotti, Pi Cluster</td>
<td>Raspberry Pi Foundation</td>
<td>Pi 4, Model B, 4 GB</td>
</tr>
</tbody>
</table>
<h2 id="network-diagram">Network Diagram</h2>
<p><img src="../img/lab_network.png" alt="Lab Network Diagram"></p>

</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-1589b8d2a4885b24db8ab843ed0dccb3">3 - Rancher</h1>
    <div class="lead">Kubernetes management platform</div>
	<p>As of Rancher v2.5, Rancher can be installed on any Kubernetes cluster.</p>
<ul>
<li>RKE</li>
<li>K3s <strong>on Raspberry Pi 4 cluster</strong></li>
<li>RKE2</li>
<li>Amazon EKS</li>
</ul>
<h4 id="installing-rancher-via-helm3">Installing Rancher via Helm3</h4>
<ol>
<li>Add the Rancher Helm chart repo</li>
</ol>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">helm repo add rancher-latest https://releases.rancher.com/server-charts/latest
</code></pre></div><h4 id="create-a-namespace-for-rancher-resources">Create a Namespace for Rancher resources</h4>
<p>Rancher documentation states that this namespace should always be called <code>cattle-system</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create namespace cattle-system
</code></pre></div><h4 id="install-cert-manager">Install cert-manager</h4>
<p>Rancher supports multiple SSL/TLS termination methods. As the laboratory cluster is on the local network and only accepting connections from the LAN, the following set of instructions will configure Rancher to generate its own certificates. Using Let&rsquo;s Encyprt and forwarding traffic from an external layer 7 load balancer are better options for production.</p>
<h4 id="install-the-customresourcedefinition-separately">Install the CustomResourceDefinition separately</h4>
<p>More info on <a href="https://kubernetes.io/docs/concepts/extend-kubernetes/api-extension/custom-resources/#customresourcedefinitions">CustomResourceDefinition</a></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl apply --validate<span style="color:#ce5c00;font-weight:bold">=</span><span style="color:#204a87">false</span> -f https://github.com/jetstack/cert-manager/releases/download/v1.0.4/cert-manager.crds.yaml
</code></pre></div><h4 id="create-the-namespace-for-cert-manager">Create the namespace for cert-manager</h4>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl create namespace cert-manager
</code></pre></div><h4 id="add-the-jetstack-helm-repository">Add the Jetstack Helm repository</h4>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">helm repo add jetstack https://charts.jetstack.io
</code></pre></div><h4 id="update-your-local-helm-chart-repository-cache">Update your local Helm chart repository cache</h4>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">helm repo update
</code></pre></div><h4 id="install-the-cert-manager-helm-chart">Install the cert-manager Helm chart</h4>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">helm install <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  cert-manager jetstack/cert-manager <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --namespace cert-manager <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --version v1.0.4
</code></pre></div><h4 id="verify-deployment">Verify Deployment</h4>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl get pods --namespace cert-manager
</code></pre></div><h4 id="install-rancher-via-helm">Install Rancher via Helm</h4>
<p>Set the hostname to the DNS name you will point to your load balancer.</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">helm install rancher rancher-latest/rancher <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --namespace cattle-system <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --ingress.tls.source<span style="color:#ce5c00;font-weight:bold">=</span>rancher <span style="color:#4e9a06">\
</span><span style="color:#4e9a06"></span>  --set <span style="color:#000">hostname</span><span style="color:#ce5c00;font-weight:bold">=</span>rancher.derekzoladz.com
</code></pre></div><h4 id="confirm-deployment-of-rancher-server">Confirm deployment of Rancher server</h4>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl -n cattle-system rollout status deploy/rancher
</code></pre></div><h2 id="troubleshooting">Troubleshooting</h2>
<p>Ensure the KUBECONFIG environment variable is set</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#204a87">export</span> <span style="color:#000">KUBECONFIG</span><span style="color:#ce5c00;font-weight:bold">=</span>/etc/rancher/k3s/k3s.yaml
</code></pre></div><p>If Helm can&rsquo;t reach the k3s cluster</p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">kubectl config view --raw &gt;~/.kube/config
</code></pre></div>
</div>



    
	
  
    
    
	
    

<div class="td-content" style="page-break-before: always">
    
	<h1 id="pg-22343580056d27515aa2241b541fb0dc">4 - Raspberry Pi Cluster</h1>
    <div class="lead">Raspberry Pi 4, Model B Cluster - Distributed Computing</div>
	<p><strong>Ligotti</strong> - this 3 node pi cluster - is named after the philosophical horror writer <a href="https://en.wikipedia.org/wiki/Thomas_Ligotti">Thomas Ligotti</a></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">ligotti             192.168.1.10  <span style="color:#000;font-weight:bold">|</span> Controller, Master 
ligotti-worker-one  192.168.1.11  <span style="color:#000;font-weight:bold">|</span> Worker One
ligotti-worker-two  192.168.1.12  <span style="color:#000;font-weight:bold">|</span> Worker Two
</code></pre></div><h2 id="hardware">Hardware</h2>
<table>
<thead>
<tr>
<th>Quantity</th>
<th>Device</th>
</tr>
</thead>
<tbody>
<tr>
<td>3</td>
<td>Raspberry Pi 4, Model B, 4 GB RAM</td>
</tr>
<tr>
<td>3</td>
<td>64 GB, Samsung Evo, microSDXC UHS-I Card, Class 10, 1 FHD</td>
</tr>
<tr>
<td>1</td>
<td>TP-Link, TL-SG105, 5-Port Gigabit Switch</td>
</tr>
<tr>
<td>3</td>
<td>Micro Connectors Acrylic Stackable Raspberry Pi Case with Fan, Power</td>
</tr>
<tr>
<td>4</td>
<td>1' CAT6 Ethernet Cables</td>
</tr>
</tbody>
</table>
<h2 id="os">OS</h2>
<ul>
<li>Ubuntu Server 20.04.2 LTS 64-bit - <a href="https://ubuntu.com/download/raspberry-pi">https://ubuntu.com/download/raspberry-pi</a></li>
<li>Flash OS images to SD cards - <a href="https://github.com/balena-io/etcher">Etcher</a></li>
</ul>
<h2 id="kubernetes">Kubernetes</h2>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/overview/what-is-kubernetes/">Kubernetes</a></li>
<li><a href="https://github.com/k3s-io/k3s">K3s</a></li>
</ul>
<h2 id="install">Install</h2>
<h4 id="connect-and-update">Connect and Update</h4>
<ul>
<li>Connect <code>ssh ubuntu@raspberry-pi-address</code></li>
<li>Update <code>sudo apt update &amp;&amp; sudo apt upgrade</code></li>
</ul>
<h4 id="set-hostname">Set Hostname</h4>
<ul>
<li>Set hostname <code>hostnamectl set-hostname &quot;ligotti&quot;</code></li>
</ul>
<h4 id="enable-c-groups">Enable c-groups</h4>
<ul>
<li>Enabled c-groups <code>sudo sed -i '1s/^/cgroup_enable=cpuset cgroup_memory=1 cgroup_enable=memory /' /boot/firmware/cmdline.txt</code></li>
</ul>
<h4 id="add-user">Add User</h4>
<ul>
<li>Add a user <code>adduser derekz</code></li>
<li>Enable passwordless sudo, <code>visudo</code> and add <code>derekz ALL=(ALL) NOPASSWD:ALL</code></li>
</ul>
<h4 id="static-ip-via-netplan">Static IP via Netplan</h4>
<p>Edit <code>/etc/netplan/50-cloud-init.yaml</code></p>
<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">network:
    ethernets:
        enp0s3:
            dhcp4: <span style="color:#204a87">false</span>
            addresses: <span style="color:#ce5c00;font-weight:bold">[</span>192.168.1.10/24<span style="color:#ce5c00;font-weight:bold">]</span>
            gateway4: 192.168.1.1
            nameservers:
              addresses: <span style="color:#ce5c00;font-weight:bold">[</span>192.168.1.51,8.8.8.8<span style="color:#ce5c00;font-weight:bold">]</span>
</code></pre></div><p>Apply changes <code>sudo netplan apply</code></p>
<h4 id="reconnect">Reconnect</h4>
<ul>
<li>Confirm IP <code>ip a</code></li>
<li><code>reboot</code></li>
</ul>
<h4 id="login-as-newly-created-user-and-create-master-node">Login as newly-created user and create Master node</h4>
<ul>
<li><code>ssh derekz@192.168.1.10</code></li>
<li><code>curl -sfL https://get.k3s.io | sh -</code></li>
<li><code>sudo k3s kubectl get node</code></li>
</ul>
<h4 id="grab-the-k3s-token">Grab the K3s token</h4>
<ul>
<li><code>sudo cat /var/lib/rancher/k3s/server/node-token</code></li>
</ul>
<h4 id="set-up-worker-nodes">Set up worker nodes</h4>
<ul>
<li><code>curl -sfL https://get.k3s.io | K3S_URL=https://master_node_IP:6443 K3S_TOKEN=token_from_K3s sh -</code></li>
<li>Check K3s agent status <code>service k3s-agent status</code></li>
<li>Restart service, if needed <code>sudo service k3s-agent restart</code></li>
</ul>

</div>



    
	
  



          </main>
        </div>
      </div>
      
<footer class="bg-dark py-5 row d-print-none">
  <div class="container-fluid mx-sm-5">
    <div class="row">
      <div class="col-6 col-sm-4 text-xs-center order-sm-2">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Email" aria-label="Email">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="mailto:derek@derekzoladz.com">
      <i class="fa fa-envelope"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Twitter" aria-label="Twitter">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://example.org/derek_zoladz">
      <i class="fab fa-twitter"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-6 col-sm-4 text-right text-xs-center order-sm-3">
        
        
        
<ul class="list-inline mb-0">
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="GitHub" aria-label="GitHub">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://github.com/dzoladz">
      <i class="fab fa-github"></i>
    </a>
  </li>
  
  <li class="list-inline-item mx-2 h3" data-toggle="tooltip" data-placement="top" title="Website" aria-label="Website">
    <a class="text-white" target="_blank" rel="noopener noreferrer" href="https://www.derekzoladz.com/">
      <i class="fas fa-globe-americas"></i>
    </a>
  </li>
  
</ul>

        
        
      </div>
      <div class="col-12 col-sm-4 text-center py-2 order-sm-2">
        <small class="text-white">&copy; 2021 Derek Zoladz. Theme by <a href="https://www.docsy.dev/docs/">Docsy</a>.<br/>
          Made with ❤️ in Columbus, OH</small>
        
	
		
	
      </div>
    </div>
  </div>
</footer>


    </div>
    
<script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js" integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy" crossorigin="anonymous"></script>











<script src="/palimpsest/js/main.min.c5f7e56b793e78a17fd95b2ec155496b72763653aaad9c7a495ac95955ce3939.js" integrity="sha256-xffla3k&#43;eKF/2VsuwVVJa3J2NlOqrZx6SVrJWVXOOTk=" crossorigin="anonymous"></script>




  </body>
</html>
